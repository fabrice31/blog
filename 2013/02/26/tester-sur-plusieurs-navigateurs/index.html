<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr-fr" itemscope="" itemtype="http://schema.org/Blog">
  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="description" content="Blog sur la qualité web en général, et l'automatisation de test web en particulier. Responsable tests et qualité web depuis 7 ans." />
  <meta name="keywords" content="test, watir, qualité, cucumber, jenkins, bug, selenium, appium, bournisien" />
  <meta name="robots" content="index,follow" />

  <title>
    
      Tester sur plusieurs navigateurs &middot; Je teste donc je suis
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700">

  <!-- Icons --
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">-->
  <link rel="shortcut icon" type="image/png" href="/public/qualite.jpg">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <link rel="stylesheet" href="/public/fancybox/jquery.fancybox.css" type="text/css" media="screen" />

  <meta property="og:image"  content="/public/pictures/web-qualite.jpg"/>
  <meta itemprop="image"     content="/public/pictures/web-qualite.jpg" />
  <meta name="twitter:image" content="/public/pictures/web-qualite.jpg" />  
</head>

  <body class="theme-base-0c layout-reverse">
    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Je teste donc je suis
        </a>
      </h1>
      <p class="lead">Blog d'un automatiseur de tests web.</p>
    </div>

    <nav class="sidebar-nav">
      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/archive/">Archive</a>
          
        
      
        
      
        
          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
	  <a class="sidebar-nav-item" href="http://www.fabricebournisien.eu">CV</a>
	  <!-- SiteSearch Google --> 
	  <form method="get" action="http://www.google.com/search"> 
		<input type="hidden" name="ie" value="UTF-8" /> 
		<input type="hidden" name="oe" value="UTF-8" /> 
		<input type="hidden" name="domains" value="blog.fabricebournisien.eu" /> 
		<input type="hidden" name="sitesearch" value="blog.fabricebournisien.eu" checked="checked" />
		<input type="text" name="q" size="18" maxlength="255" value="" />
		<input type="submit" name="btnG" value="Chercher" /> 
	  </form>
	  <!-- SiteSearch Google -->
    </nav>

    <p>&copy; 2014 - <a href="https://plus.google.com/104493142924184161356" rel="author">Fabrice Bournisien</a></p>
  </div>
</div>

    <div class="content container">
      <div class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
  <h2 class="post-title" itemprop="name">Tester sur plusieurs navigateurs</h2>
  <span class="post-date">
	  <time class="date" datetime="2013-02-26" itemprop="datePublished">
		26/02/2013
	  </time>
	  - par Fabrice Bournisien
		
		- <a href="/tag/cucumber">Cucumber</a>
		
		- <a href="/tag/watir">Watir</a>
		
  </span>

	<div itemprop="ArticleBody"><p>Tester de façon automatique, c&#39;est bien. Le faire sur plusieurs environnements, c&#39;est mieux.</p>

<p>Dans mon cas, par défaut, mes tests sont lancés sur Firefox. Sur un serveur jenkins-ci (sur debian), c&#39;est en effet le navigateur le plus facile à gérer. Ils sont exécutés une fois par jour, et aussi à la demande.</p>

<p>Certains scenarios testent la version mobile de nos sites. Il nous faut aussi tester nos sites pour différents navigateurs. Pour cela, les profils et les tags de cucumber sont très intéressants.</p>

<h3>Tags cucumber</h3>

<p>Au dessus de chaque scénario, il est possible de lister des tags. On peut ensuite exécuter tous les tests portant un tag particulier.</p>

<p>Cela permet de découper l&#39;exécution de nombreux scénarios en plusieurs jobs sur jenkins, ce qui est plus confortable : si un test passe dans le rouge, il faut analyser un rapport pour 10 scénario au lieu de 300. Si on veut re-tester ce point précis, on mettra également moins de temps.</p>

<p>On exécute les scénarios avec la ligne &quot;cucumber --tag @montag&quot;. Si le tag n&#39;existe pas, le résultat affichera immédiatement 0 scenarios.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="vi">@admin</span> <span class="vi">@montag</span> <span class="vi">@ie</span>
<span class="no">Scenario</span><span class="p">:</span> <span class="nb">test</span> <span class="n">un</span> <span class="n">tag</span>
  <span class="no">When</span> <span class="no">I</span> <span class="nb">test</span>
  <span class="no">Then</span> <span class="no">I</span> <span class="n">tested</span>
</code></pre></div>
<h3>Cucumber.yml</h3>

<p>Les profils de cucumber se gère dans un fichier au format yaml, qui peut gérer beaucoup de choses :</p>

<ul>
<li>Ajouter automatiquement des paramètres de tags</li>
<li>Passer des variables à l&#39;environnement de tests, qui peut ensuite les utiliser.</li>
</ul>

<p>Exemple avec une partie de mon fichier :</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&lt;</span><span class="sx">% common </span><span class="o">=</span> <span class="s2">"-r support -r features --tags ~@wip --tags ~@danger 
--color --format pretty --format html -o results.html --format junit -o junit"</span> <span class="o">%&gt;</span>
<span class="c1"># default : staging and firefox</span>
<span class="ss">default: </span><span class="o">&lt;</span><span class="sx">%= common %&gt; BROWSER=</span><span class="n">firefox</span>
<span class="ss">danger: </span><span class="o">-</span><span class="n">r</span> <span class="n">support</span> <span class="o">-</span><span class="n">r</span> <span class="n">features</span> <span class="o">--</span><span class="n">tags</span> <span class="o">~</span><span class="vi">@wip</span> <span class="o">--</span><span class="n">color</span> <span class="o">--</span><span class="nb">format</span> <span class="n">pretty</span> <span class="no">BROWSER</span><span class="o">=</span><span class="n">firefox</span>
<span class="ss">ie: </span><span class="o">&lt;</span><span class="sx">%= common %&gt; ENV=</span><span class="n">staging</span> <span class="no">BROWSER</span><span class="o">=</span><span class="n">ie</span>
<span class="ss">ff: </span><span class="o">&lt;</span><span class="sx">%= common %&gt; ENV=</span><span class="n">staging</span> <span class="no">BROWSER</span><span class="o">=</span><span class="n">firefox</span>
<span class="ss">chrome: </span><span class="o">&lt;</span><span class="sx">%= common %&gt; ENV=</span><span class="n">staging</span> <span class="no">BROWSER</span><span class="o">=</span><span class="n">chrome</span>
<span class="ss">mobile: </span><span class="o">&lt;</span><span class="sx">%= common %&gt; ENV=</span><span class="n">staging</span> <span class="no">BROWSER</span><span class="o">=</span><span class="n">mobile</span>
</code></pre></div>
<p>La première ligne définit des paramètres commun à la plupart des profils :</p>

<ul>
<li>On impose de récupérer le dossier features (dans lequel se trouvent les scenarios) et le dosser support (qui contient le code qui &quot;gère&quot; le navigateur)</li>
<li>On exclut les tests portant le tag @wip (work in progress) et le tag @danger</li>
<li>On demande l&#39;affichage des résultats complets (avec les étapes et la couleur)</li>
<li>On demande l&#39;export des résultats au format html et au format junit</li>
</ul>

<p>Lorsqu&#39;on utilise un profil, on peut lancer pour un tag donné. Exemple : <code>cucumber . --tag @test -p chrome</code></p>

<p>Viennent ensuite les profils :</p>

<ul>
<li>-p default: lance les tests sur firefox</li>
<li>-p danger: autorise le lancement des tests taggués @danger</li>
<li>-p ie, ff, chrome, mobile: lance les tests sur un navigateur particulier</li>
</ul>

<h3>Différences entre les navigateurs</h3>

<p>Passer le nom du navigateur ne suffit pas, il faut également l&#39;utiliser dans le code pour travailler avec le navigateur voulu.</p>

<p>Dans notre cas, nous lancons le navigaeur avant chaque scénario pour éviter qu&#39;un test ait un impact sur le suivant.</p>

<p>Voici le code :</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Before</span> <span class="k">do</span>
  <span class="k">case</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'BROWSER'</span><span class="p">]</span>
  <span class="k">when</span> <span class="s1">'ie'</span>
    <span class="vi">@browser</span> <span class="o">=</span> <span class="no">Watir</span><span class="o">::</span><span class="no">Browser</span><span class="p">.</span><span class="nf">new</span> <span class="ss">:ie</span>
  <span class="k">when</span> <span class="s1">'mobile'</span>
    <span class="n">mobile_useragent</span> <span class="o">=</span> <span class="s2">"Mozilla/5.0 (iPhone; CPU iPhone OS 5_1_1 like \
        Mac OS X) AppleWebKit/534.46 (KHTML, like Gecko) Version/5.1 \
        Mobile/9B206 Safari/7534.48.3"</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Firefox</span><span class="o">::</span><span class="no">Profile</span><span class="p">.</span><span class="nf">new</span>
    <span class="n">profile</span><span class="p">[</span><span class="s1">'general.useragent.override'</span><span class="p">]</span> <span class="o">=</span> <span class="n">mobile_useragent</span>
    <span class="vi">@browser</span> <span class="o">=</span> <span class="no">Watir</span><span class="o">::</span><span class="no">Browser</span><span class="p">.</span><span class="nf">new</span> <span class="ss">:firefox</span><span class="p">,</span> <span class="ss">:profile</span> <span class="o">=&gt;</span> <span class="n">profile</span>
  <span class="k">when</span> <span class="s1">'chrome'</span>
    <span class="vi">@browser</span> <span class="o">=</span> <span class="no">Watir</span><span class="o">::</span><span class="no">Browser</span><span class="p">.</span><span class="nf">new</span> <span class="ss">:chrome</span>
  <span class="k">else</span>
    <span class="c1"># Default case : firefox</span>
    <span class="n">download_directory</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="no">Dir</span><span class="p">.</span><span class="nf">pwd</span><span class="si">}</span><span class="s2">/downloads"</span>
    <span class="n">download_directory</span><span class="p">.</span><span class="nf">gsub!</span><span class="p">(</span><span class="s2">"/"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">"</span><span class="p">)</span> <span class="p">\</span>
        <span class="k">if</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Platform</span><span class="p">.</span><span class="nf">windows?</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Firefox</span><span class="o">::</span><span class="no">Profile</span><span class="p">.</span><span class="nf">new</span>
    <span class="n">profile</span><span class="p">[</span><span class="s1">'browser.download.folderList'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">profile</span><span class="p">[</span><span class="s1">'browser.download.dir'</span><span class="p">]</span> <span class="o">=</span> <span class="n">download_directory</span>
    <span class="n">profile</span><span class="p">[</span><span class="s1">'browser.link.open_newwindow'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">profile</span><span class="p">[</span><span class="s1">'browser.helperApps.neverAsk.saveToDisk'</span><span class="p">]</span> <span class="o">=</span> <span class="p">\</span>
        <span class="s2">"application/octet-stream"</span>
    <span class="n">profile</span><span class="p">[</span><span class="s1">'network.http.use-cache'</span><span class="p">]</span> <span class="o">=</span> <span class="kp">false</span>
    <span class="vi">@browser</span> <span class="o">=</span> <span class="no">Watir</span><span class="o">::</span><span class="no">Browser</span><span class="p">.</span><span class="nf">new</span> <span class="ss">:firefox</span><span class="p">,</span> <span class="ss">:profile</span> <span class="o">=&gt;</span> <span class="n">profile</span>
  <span class="k">end</span>
  <span class="c1"># Resize window</span>
  <span class="k">if</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'BROWSER'</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">'mobile'</span>
    <span class="vi">@browser</span><span class="p">.</span><span class="nf">window</span><span class="p">.</span><span class="nf">resize_to</span><span class="p">(</span><span class="mi">1100</span><span class="p">,</span> <span class="mi">900</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="vi">@browser</span><span class="p">.</span><span class="nf">window</span><span class="p">.</span><span class="nf">resize_to</span><span class="p">(</span><span class="mi">640</span><span class="p">,</span> <span class="mi">960</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>On exploite le nom du navigateur pour lancer le bon, avec des paramètres particuliers.</p>

<ul>
<li>Le mobile lance un Firefox avec le profil d&#39;un navigateur Iphone (et une résolution de classique pour un mobile)</li>
<li>Pour internet explorer et chrome, il faut avoir téléchargé les exécutables (sur le groupe selenium) et les avoir ajoutés au path</li>
<li>Pour firefox, on ajoute des paramètres pour effectuer des tests d&#39;upload et download de fichiers)</li>
</ul>

<h3>Les tests ont-ils changés ?</h3>

<p>Lorsque j&#39;ai commencé à coder ces tests, il y a plus d&#39;un an, j&#39;avais anticipé l&#39;architecture pour gérer ce genre de problématique. La mise en place n&#39;a pourtant pas eu lieu sans douleur.</p>

<p>Certains navigateurs ne se comportent pas tout à fait comme les autres. Il faut donc mettre à jour son code pour qu&#39;il soit le plus &quot;ré utilisable possible&quot;.</p>

<p>Dans le cas d&#39;Internet Explorer, les modifications apportées :</p>

<ul>
<li>Ajout d&#39;un tag @ie sur les tests compatibles (et stables) avec IE.</li>
<li>Dans certains cas de remplissage de formulaire, ajout d&#39;une ligne de code pour donner le focus au champ à remplir</li>
<li>Modification des timeout du projet.</li>
</ul>

<p>On lance donc les tests pour Internet Explorer avec la commande <code>cucumber --tag @ie -p ie</code>. On peut changer le tag, mais certains ne fonctionnent pas encore sous IE à cause de codes vraiment spécifiques.</p>

<p>Voici deux exemples de code modifé spécifiquement pour IE :</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">if</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'BROWSER'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'ie'</span>
  <span class="c1"># internet explorer is slower : timeout increase</span>
  <span class="no">SHORT_TIMEOUT</span> <span class="o">=</span> <span class="mi">5</span>
  <span class="no">TIMEOUT</span> <span class="o">=</span> <span class="mi">15</span>
  <span class="no">LONG_TIMEOUT</span> <span class="o">=</span> <span class="mi">25</span>
<span class="k">else</span>
  <span class="no">SHORT_TIMEOUT</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="no">TIMEOUT</span> <span class="o">=</span> <span class="mi">9</span>
  <span class="no">LONG_TIMEOUT</span> <span class="o">=</span> <span class="mi">25</span>
<span class="k">end</span>
</code></pre></div>
<p>Ce code définit les constantes des timeout pour l&#39;ensemble des test.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">if</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'BROWSER'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'ie'</span>
  <span class="nb">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># need for IE purpose</span>
<span class="k">end</span>
<span class="nb">self</span><span class="p">.</span><span class="nf">wait_until</span><span class="p">(</span><span class="no">LONG_TIMEOUT</span><span class="p">){</span>
  <span class="nb">self</span><span class="p">.</span><span class="nf">login_element</span><span class="p">.</span><span class="nf">exists?</span> <span class="n">and</span> <span class="nb">self</span><span class="p">.</span><span class="nf">login_element</span><span class="p">.</span><span class="nf">visible?</span>
<span class="p">}</span>
<span class="nb">self</span><span class="p">.</span><span class="nf">username_element</span><span class="p">.</span><span class="nf">focus</span> <span class="c1"># need for IE purpose</span>
<span class="nb">self</span><span class="p">.</span><span class="nf">username</span> <span class="o">=</span> <span class="vi">@account</span><span class="p">.</span><span class="nf">email</span>
</code></pre></div>
<p>Les commentaires dans le code parlent d&#39;eux mêmes. Documenter le code spécifique à IE est d&#39;ailleurs indispensable si on veut garder ses modifications qui semblent &quot;inutiles&quot;.</p>

<p>Si les tests avec Firefox sont joués chaque jour sur un serveur, en 2h45 environ, ceux pour IE sont exécutés en local, en 3h, alors que certains tests ne sont pas exécutés sur IE.</p>

<p>Ce sont donc plus de 300 scénarios par jour, 12 000 par mois. Sans compter les tests unitaires, les tests manuels...</p>
</div>

	<div class="share">
		<div class="twitter-share">
			<iframe src="http://platform.twitter.com/widgets/tweet_button.html?url=http%3A%2F%2Fblog.fabricebournisien.eu%2F%2F2013%2F02%2F26%2Ftester-sur-plusieurs-navigateurs%2F&amp;via=fabrice31&amp;text=Tester sur plusieurs navigateurs&amp;lang=fr&amp;count=horizontal" frameborder="0" allowTransparency="1" scrolling="no" style="height:20px;width:133px;"></iframe>
		</div>
		<div class="facebook-share">
			<iframe src="//www.facebook.com/plugins/like.php?href=http://blog.fabricebournisien.eu//2013/02/26/tester-sur-plusieurs-navigateurs/&amp;send=false&amp;layout=button_count&amp;show_faces=false&amp;action=like&amp;colorscheme=light&amp;font" frameborder="0" allowTransparency="1" scrolling="no" style="height:20px;width:133px;"></iframe>
		</div>
		<div class="google-share">
			<iframe src="https://plusone.google.com/u/0/_/+1/fastbutton?url=http://blog.fabricebournisien.eu//2013/02/26/tester-sur-plusieurs-navigateurs/&amp;size=medium&amp;annotation=bubble&amp;lang=fr" frameborder="0" allowTransparency="1" scrolling="no" style="height:20px;width:90px;"></iframe>
		</div>
	</div>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
		  <a href="http://blog.fabricebournisien.eu//2012/02/09/l-environnement-et-les-tests/">
			L'environnement et les tests
			<small>09 Feb 2012</small>
		  </a>
      </li>
    
      <li>
		  <a href="http://blog.fabricebournisien.eu//2012/05/07/valider-un-theme/">
			Valider un thème
			<small>07 May 2012</small>
		  </a>
      </li>
    
      <li>
		  <a href="http://blog.fabricebournisien.eu//2013/04/22/comment-organiser-les-tests-sur-le-long-terme/">
			Comment organiser les tests sur le long terme
			<small>22 Apr 2013</small>
		  </a>
      </li>
    
  </ul>
</div>

<script src="https://apis.google.com/js/plusone.js"></script>
<div class="g-comments"
    data-href="http://blog.fabricebournisien.eu//2013/02/26/tester-sur-plusieurs-navigateurs/"
    data-width="642"
    data-first_party_property="BLOGGER"
    data-view_type="FILTERED_POSTMOD">
</div>

    </div>

  <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
  <script type="text/javascript" src="/public/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/public/js/script.js"></script>
  </body>
</html>
