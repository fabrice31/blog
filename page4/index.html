<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr-fr" itemscope="" itemtype="http://schema.org/Blog">
  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="description" content="Blog sur la qualité web en général, et l'automatisation de test web en particulier. Responsable tests et qualité web depuis 7 ans." />
  <meta name="keywords" content="test, watir, qualité, cucumber, jenkins, bug, selenium, appium, bournisien" />
  <meta name="robots" content="index,follow" />

  <title>
    
      Je teste donc je suis &middot; Journal d'un testeur
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700">

  <!-- Icons --
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">-->
  <link rel="shortcut icon" type="image/png" href="/public/qualite.jpg">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <link rel="stylesheet" href="/public/fancybox/jquery.fancybox.css" type="text/css" media="screen" />

  <meta property="og:image"  content="/public/pictures/web-qualite.jpg"/>
  <meta itemprop="image"     content="/public/pictures/web-qualite.jpg" />
  <meta name="twitter:image" content="/public/pictures/web-qualite.jpg" />  
</head>

  <body class="theme-base-0c layout-reverse">
    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Je teste donc je suis
        </a>
      </h1>
      <p class="lead">Blog d'un automatiseur de tests web.</p>
    </div>

    <nav class="sidebar-nav">
      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/archive/">Archive</a>
          
        
      
        
      
        
          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
	  <a class="sidebar-nav-item" href="http://www.fabricebournisien.eu">CV</a>
	  <!-- SiteSearch Google --> 
	  <form method="get" action="http://www.google.com/search"> 
		<input type="hidden" name="ie" value="UTF-8" /> 
		<input type="hidden" name="oe" value="UTF-8" /> 
		<input type="hidden" name="domains" value="blog.fabricebournisien.eu" /> 
		<input type="hidden" name="sitesearch" value="blog.fabricebournisien.eu" checked="checked" />
		<input type="text" name="q" size="18" maxlength="255" value="" />
		<input type="submit" name="btnG" value="Chercher" /> 
	  </form>
	  <!-- SiteSearch Google -->
    </nav>

    <p>&copy; 2014 - <a href="https://plus.google.com/104493142924184161356" rel="author">Fabrice Bournisien</a></p>
  </div>
</div>

    <div class="content container">
      <div class="posts">
  
  <div class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
    <h2 class="post-title" itemprop="name">
      <a href="/2013/04/02/l-armee-paie-ses-militaires-ou-pas/" itemprop="url" rel="bookmark">
        L'armée ne paie pas toujours ses militaires
      </a>
    </h2>

	<span class="post-date">
		<time class="date" datetime="2013-04-02" itemprop="datePublished">
			02/04/2013
		</time>
		- par Fabrice Bournisien
		
		- <a href="/tag/bug">Bug</a>
		
	</span>

	<div itemprop="ArticleBody"><p>Il y a plusieurs mois, j&#39;avais tweeté &quot;Les bugs, ça coûte cher : Noël sans solde pour des milliers de soldats français&quot;</p>

<p>Source : <a href="http://www.lemonde.fr/international/article/2012/12/21/des-milliers-de-soldats-francais-non-payes-a-cause-d-un-bug-informatique_1809606_3210.html">http://www.lemonde.fr/international/article/2012/12/21/des-milliers-de-soldats-francais-non-payes-a-cause-d-un-bug-informatique<em>1809606</em>3210.html</a></p>

<p>Pour résumer : dans les anciens logiciels de paie des militaires français, il y avait parfois des petites erreurs, des petits bugs, qui étaient corrigés les mois suivants. Mais en 2012, mise à jour complète du logiciel.</p>

<h2>Louvois, le logiciel le plus buggué de l&#39;histoire ?</h2>

<p>La dernière version du logiciel, surnommée &quot;Louvois&quot; (Logiciel unique à vocation interarmées de la solde) , est tellement remplie de bugs que certains militaires ont de légers problèmes. (Exemples en fin d&#39;article)</p>

<p>Il y a un mois, on pouvait lire dans la presse que les bugs devaient être corrigés pour Noël 2012, mais ne l&#39;étaient pas encore mi février 2013.</p>

<p>Source : <a href="http://www.lemagit.fr/technologie/applications/applications-transversales-pgi/2013/02/20/logiciel-de-paie-louvois-la-guerre-de-le-drian-est-loin-detre-gagnee/">http://www.lemagit.fr/technologie/applications/applications-transversales-pgi/2013/02/20/logiciel-de-paie-louvois-la-guerre-de-le-drian-est-loin-detre-gagnee/</a></p>

<p>On envisagerait donc de revenir à l&#39;ancien logiciel, moins buggué. Mais cela prendrait entre 12 et 14 mois, donc, mi 2014 au mieux.</p>

<p>Une autre source indique que l&#39;armée de l&#39;air paierait déjà ses hommes via un autre logiciel pour éviter les bugs : <a href="http://www.marianne.net/blogsecretdefense/Louvois-l-armee-de-Terre-pourrait-revenir-a-l-ancien-systeme-de-paiement-des-soldes_a942.html">http://www.marianne.net/blogsecretdefense/Louvois-l-armee-de-Terre-pourrait-revenir-a-l-ancien-systeme-de-paiement-des-soldes_a942.html</a></p>

<blockquote>
<p>Les erreurs occasionnées par Louvois représentent 1 % de la masse salariale du ministère de la Défense, pour près de 120 000 incidents
<em>Le Canard Enchaîné</em></p>
</blockquote>

<h3>Et pendant ce temps, dans l&#39;armée de terrain</h3>

<ul>
<li>Saisie sur salaire à un miliaire, pour une somme déjà payée au trésor public par le militaire par ailleurs. (Donc, il est dans le rouge, et paie 2 fois). Temps avant remboursement : plusieurs mois.</li>
<li>Un homme qui doit faire vivre sa famille un mois entier avec 60 euros : <a href="http://storify.com/fabrice31/l-armee-mauvais-payeur">http://storify.com/fabrice31/l-armee-mauvais-payeur</a></li>
<li>Soldes payées avec des mois de retard sur le terrain</li>
<li>Primes prévues mais reportées, payées avec plusieurs mois de retard...</li>
<li>Sur une compagnie de 120 hommes, pour le même mois, déjà plus de 20 cas recensés avec une erreur sur le solde, de 150 à 1 400 €. (La cause serait la prime versée le mois précédent, considérée comme un trop perçu par le logiciel)</li>
</ul>

<p>Si des militaires veulent poursuivre la liste, n&#39;hésitez pas, je compléterai avec plaisir cette liste de bugs. (un formulaire de contact anonyme est disponible en bas de page)</p>

<p><img src="/public/pictures/2013/armee-francaise1.jpg" alt="L&#39;armée ne paie pas toujours ses militaires." title="L&#39;armée, quel beau métier"></p>

<h3>Et si c&#39;était vous ?</h3>

<p><strong>Rappel</strong> : les militaires n&#39;ont pas le droit de manifester / faire grève...</p>

<p>Imaginez, si cela ne touchait pas l&#39;armée, mais une société lambda ?</p>

<ul>
<li>Une société privée avec un bug aussi important (même une seule fois) qui ne corrige pas dans les jours qui suivent la situation de tous les salariés : que diront les prud&#39;hommes ?</li>
<li>Une société qui a un bug dans 1% des paies qu&#39;elle verse, Sur une petite PME de 20 personnes, cela fait 1 seule erreur de paie tous les 5 mois. 2.5 erreurs par an.</li>
<li>Pour l&#39;armée, ça représente 3220 personnes par mois. (322 000 emplois en 2007)</li>
<li>Imaginez, si ce mois-ci, votre conjoint(e) reçoit un salaire de 60 € à cause d&#39;une erreur de logiciel, et la suite viendra &quot;plus tard&quot;, délai non confirmé. De quoi vous passez vous ? Payer votre loyer, vos crédits ? Les couches de bébé ?</li>
</ul>

<p>Une page facebook parlait en 2012 du problème : <a href="Le%20paquet%20de%20gauloises%20en%20col%C3%A8re%5D">https://www.facebook.com/pages/Un-paquet-de-Gauloises/416293095105059</a></p>
</div>
  </div>
  
  <div class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
    <h2 class="post-title" itemprop="name">
      <a href="/2013/03/18/quand-un-commercant-en-ligne-a-des-bugs/" itemprop="url" rel="bookmark">
        Quand un commerçant en ligne a des bugs
      </a>
    </h2>

	<span class="post-date">
		<time class="date" datetime="2013-03-18" itemprop="datePublished">
			18/03/2013
		</time>
		- par Fabrice Bournisien
		
		- <a href="/tag/bug">Bug</a>
		
	</span>

	<div itemprop="ArticleBody"><p>On peut être un grand nom de la vente en ligne, mais avoir malgré cela des problèmes sur son site web.</p>

<p>Parfois, cela se passe &quot;presque bien&quot; : tout le monde se souvient encore de l&#39;homme nu de La Redoute (une photo présentant un produit avec en fond un homme nu). Tout le monde a rigolé, s&#39;est moqué d&#39;eux. Ils ont corrigé le tir, puis ont lancé un jeu pour trouver certains objets dans d&#39;autres images pour les gagner.</p>

<h3>Et parfois, c&#39;est le &quot;drame&quot;</h3>

<p>Prenons un cas pratique, qui m&#39;est arrivé.</p>

<p>Je suis client chez <a href="boulanger.fr">http://www.boulanger.fr/</a> depuis longtemps, j&#39;ai une carte de fidelité, etc. En janvier, j&#39;ai rencontré des difficultés pour utiliser un chèque cadeau sur une commande. J&#39;ai contacté leur support par un formulaire par mail : aucune nouvelle.</p>

<p>J&#39;ai tweeté : une cm m&#39;a demandé une copie du mail et m&#39;a confirmé avoir transférée ma demande à l&#39;équipe technique. Au menu : des problèmes d&#39;ergonomie, de textes pas clairs...</p>

<p>Ce week-end, j&#39;ai reçu un mail pour me dire que mon chèque cadeau n&#39;était pas utilisé. Petit tour sur mon espace client, quelques soucis rencontrés en quelques minutes.</p>

<h3>Les commandes fantômes</h3>

<p>Page &quot;Commandes en cours&quot;, j&#39;ai deux commandes notées &quot;expédiées&quot; :</p>

<ul>
<li>Celle de fin novembre. Que j&#39;ai reçue en décembre, sans souci.</li>
<li>Celle de janvier. Que j&#39;ai reçue (en deux fois, l&#39;un des articles était indisponible. J&#39;ai été averti de l&#39;indisponibilité, j&#39;ai choisi d&#39;attendre : 5 semaines avant la livraison)</li>
</ul>

<h3>La saisie impossible (d&#39;un chèque cadeau)</h3>

<p>Pour saisir un chèque cadeau, quelques étapes :</p>

<ul>
<li>Validez votre panier</li>
<li>Au milieu de la page de paiement, cochez oui à la phrase &quot;Vous béneficiez de cartes cadeau, cartes satisfaction ou chèques fidélité ?&quot;</li>
<li>Sélectionnez &quot;Chèque cadeau&quot;.</li>
<li>Pour les férus d&#39;accessibilité : c&#39;est un div. (L&#39;image de fond est appliqué au div parent)</li>
<li>Pour les férus de webperf : l&#39;image est chargée 2 fois, avec 2 adresses différentes.</li>
<li>Saisissez le numéro du chèque (copier / coller, en faisant attention aux espaces)</li>
<li>Saisissez le montant du chèque (Apparement, Boulanger ne connait pas le montant en fonction du numéro de chèque...) 
Attention, pas de format indiqué : 25,10 / 25.10 / 25€10 : bonne chance.</li>
<li>Recopiez un captcha</li>
<li>Validez le chèque</li>
</ul>

<p><img src="/public/pictures/2013/boulanger-saisie-cheque.jpg" alt="8 moyens de paiements. +1 caché"></p>

<p>Voilà, la page se recharge, referme la partie chèque, et vous passez à la suite. Oui, mais :</p>

<ul>
<li>Si tout va bien, la ligne pour le chèque figure en bas de la page d&#39;après ce qu&#39;ils disent.</li>
<li>Si une erreur s&#39;est produite, vous devez :

<ul>
<li>Au milieu de la page de paiement, il faut cocher à nouveau la phrase &quot;Vous béneficiez de cartes cadeau, cartes satisfaction ou chèques fidélité ?&quot;</li>
<li>Sélectionner &quot;Chèque cadeau&quot;.</li>
<li>Regarder si par hasard, une ligne rouge n&#39;est pas affichée. Avec un message d&#39;erreur du genre &quot;Le paiement n&#39;est pas valide&quot;. Bonne chance pour comprendre quelle est l&#39;erreur. Si vous tapez le montant &quot;AA&quot; ou un numéro de chèque erroné, vous aurez la même erreur.</li>
</ul></li>
</ul>

<p><img src="/public/pictures/2013/boulanger-saisie-cheque2.jpg" alt="Un message d&#39;erreur (enfin, façon de parler)"></p>

<h3>Vous avez demandé le service client, ne quittez pas</h3>

<p>En bas de page, un lien contact : je me dis que je vais leur expliquer ce que je pense de leur site.</p>

<ul>
<li>Je clique sur le lien en bas de page</li>
<li>Une page apparaît avec une liste de 8 &quot;services&quot; pour les contacter. Je clique sur &quot;Contactez Boulanger.fr&quot; (accessibilité : nulle. c&#39;est une image sans texte alternatif)</li>
<li>Une page différente apparaît, avec les 8 services, où celui que j&#39;ai sélectionné est &quot;ouvert&quot;. Aucun des choix proposés ne me convient. Je change de service pour &quot;Les produits ou les services (je vous ai parlé de la non accessibilité du site ?). Voilà, je peux choisir un type de contact qui me convient &quot;Question concernant la carte de fidélité&quot;</li>
<li>Et là, alors que je suis connecté, qu&#39;ils ont donc mon adresse, mon numéro de client, mon email, je dois remplir quelques informations.

<ul>
<li>Informations obligatoires (présence de * à coté de l&#39;intitulé) : Nom, prénom, numéro de téléphone (là encore, pas de format... je choisi donc le format international), email, choix du mode de contact de leur part (email ou téléphone), et ma question</li>
<li>Le numéro de la carte de fidélité n&#39;est pas obligatoire : ouf.</li>
<li>Des cases pour accepter ou non de recevoir des mails de promos de Boulanger et de ses partenaires (avec une ligne en gris sur fond blanc, que j&#39;ai trouvé peu lisible...)</li>
</ul></li>
<li>J&#39;écris un long mail (cet article est issu du mail). Enfin, je ne l&#39;écris pas dans le champ : le textarea de 6 lignes, 32 colonnes, non redimensionnable est trop petit pour ma prose.</li>
<li>Je l&#39;envoie. Ah tiens, j&#39;ai un message d&#39;erreur (il est clair cette fois) : je n&#39;ai pas saisi mon numéro de carte boulanger. Même s&#39;il est &quot;logique&quot; de devoir saisir le numéro sur la page de contact à ce sujet, c&#39;est pourtant le seul champ que je ne suis pas obligé de remplir.</li>
<li>Je remplis le champ par mon numéro, qui d&#39;après leur aide (qui apparaît au survol.. accessibilité...) doit faire 10 caractères. Sauf que je peux en mettre 12 ou plus en fait. Le champ n&#39;est pas limité en nombre de caractères.</li>
<li>J&#39;arrive tout de même à envoyer mon mail, et j&#39;ai donc un joli message de confirmation. Par expérience, j&#39;aurais aimé recevoir une copie par mail. Pour ne pas perdre mon message, et l&#39;avoir si on me demande de redonner des infos.</li>
</ul>

<p><img src="/public/pictures/2013/boulanger-confirmation.jpg" alt="Boulanger, une fois le mail envoyé"></p>

<h3>Pour aller plus loin</h3>

<p>Après avoir envoyé le mail, j&#39;ai commencé mon article, et j&#39;ai du coup été tatillon : lecture du code source de quelques pages, etc. Quelques trucs qui me chiffonnent en vrac :</p>

<ul>
<li>La page de contact n&#39;a pas de balise &quot;title&quot;</li>
<li>A la louche : 4 fichiers css (+2 pour le print), 20 fichiers js...</li>
<li>Le design du formulaire de contact en balise table dans une balise table dans une balise table.</li>
<li>La vérification des champs provoque un message d&#39;erreur (un seul : c&#39;est une bonne chose) mais est faite en javascript (accessibilité...)</li>
<li>Des balises mises en commentaires HTML.</li>
<li>La liste des mot-clés (meta keyword) me semble un peu longue, mais admettons. Par contre, le dernier mot-clé est terminé par un point. Étrange.</li>
</ul>

<p>A la base, je comptais juste faire un achat rapide. Je viens de passer la soirée à faire un audit qualité (bug / ergonomie / accessibilité / webperf) à boulanger. C&#39;est cadeau : je n&#39;ai fait que survoler. J&#39;encourage Boulanger à le faire à fond (ou mieux, à le faire faire par des experts).
(Evidemment, si j&#39;ai une réponse, je la publierais ici)</p>
</div>
  </div>
  
  <div class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
    <h2 class="post-title" itemprop="name">
      <a href="/2013/02/26/tester-sur-plusieurs-navigateurs/" itemprop="url" rel="bookmark">
        Tester sur plusieurs navigateurs
      </a>
    </h2>

	<span class="post-date">
		<time class="date" datetime="2013-02-26" itemprop="datePublished">
			26/02/2013
		</time>
		- par Fabrice Bournisien
		
		- <a href="/tag/cucumber">Cucumber</a>
		
		- <a href="/tag/watir">Watir</a>
		
	</span>

	<div itemprop="ArticleBody"><p>Tester de façon automatique, c&#39;est bien. Le faire sur plusieurs environnements, c&#39;est mieux.</p>

<p>Dans mon cas, par défaut, mes tests sont lancés sur Firefox. Sur un serveur jenkins-ci (sur debian), c&#39;est en effet le navigateur le plus facile à gérer. Ils sont exécutés une fois par jour, et aussi à la demande.</p>

<p>Certains scenarios testent la version mobile de nos sites. Il nous faut aussi tester nos sites pour différents navigateurs. Pour cela, les profils et les tags de cucumber sont très intéressants.</p>

<h3>Tags cucumber</h3>

<p>Au dessus de chaque scénario, il est possible de lister des tags. On peut ensuite exécuter tous les tests portant un tag particulier.</p>

<p>Cela permet de découper l&#39;exécution de nombreux scénarios en plusieurs jobs sur jenkins, ce qui est plus confortable : si un test passe dans le rouge, il faut analyser un rapport pour 10 scénario au lieu de 300. Si on veut re-tester ce point précis, on mettra également moins de temps.</p>

<p>On exécute les scénarios avec la ligne &quot;cucumber --tag @montag&quot;. Si le tag n&#39;existe pas, le résultat affichera immédiatement 0 scenarios.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="vi">@admin</span> <span class="vi">@montag</span> <span class="vi">@ie</span>
<span class="no">Scenario</span><span class="p">:</span> <span class="nb">test</span> <span class="n">un</span> <span class="n">tag</span>
  <span class="no">When</span> <span class="n">I</span> <span class="nb">test</span>
  <span class="no">Then</span> <span class="n">I</span> <span class="n">tested</span>
</code></pre></div>
<h3>Cucumber.yml</h3>

<p>Les profils de cucumber se gère dans un fichier au format yaml, qui peut gérer beaucoup de choses :</p>

<ul>
<li>Ajouter automatiquement des paramètres de tags</li>
<li>Passer des variables à l&#39;environnement de tests, qui peut ensuite les utiliser.</li>
</ul>

<p>Exemple avec une partie de mon fichier :</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&lt;</span><span class="sx">% common </span><span class="o">=</span> <span class="s2">"-r support -r features --tags ~@wip --tags ~@danger 
--color --format pretty --format html -o results.html --format junit -o junit"</span> <span class="sx">%&gt;
# default : staging and firefox
default: &lt;%= common %&gt;</span> <span class="no">BROWSER</span><span class="o">=</span><span class="n">firefox</span>
<span class="ss">danger: </span><span class="o">-</span><span class="n">r</span> <span class="n">support</span> <span class="o">-</span><span class="n">r</span> <span class="n">features</span> <span class="o">--</span><span class="n">tags</span> <span class="o">~</span><span class="vi">@wip</span> <span class="o">--</span><span class="n">color</span> <span class="o">--</span><span class="nb">format</span> <span class="n">pretty</span> <span class="no">BROWSER</span><span class="o">=</span><span class="n">firefox</span>
<span class="ss">ie: </span><span class="o">&lt;</span><span class="sx">%= common %&gt; ENV=</span><span class="n">staging</span> <span class="no">BROWSER</span><span class="o">=</span><span class="n">ie</span>
<span class="ss">ff: </span><span class="o">&lt;</span><span class="sx">%= common %&gt; ENV=</span><span class="n">staging</span> <span class="no">BROWSER</span><span class="o">=</span><span class="n">firefox</span>
<span class="ss">chrome: </span><span class="o">&lt;</span><span class="sx">%= common %&gt; ENV=</span><span class="n">staging</span> <span class="no">BROWSER</span><span class="o">=</span><span class="n">chrome</span>
<span class="ss">mobile: </span><span class="o">&lt;</span><span class="sx">%= common %&gt; ENV=</span><span class="n">staging</span> <span class="no">BROWSER</span><span class="o">=</span><span class="n">mobile</span>
</code></pre></div>
<p>La première ligne définit des paramètres commun à la plupart des profils :</p>

<ul>
<li>On impose de récupérer le dossier features (dans lequel se trouvent les scenarios) et le dosser support (qui contient le code qui &quot;gère&quot; le navigateur)</li>
<li>On exclut les tests portant le tag @wip (work in progress) et le tag @danger</li>
<li>On demande l&#39;affichage des résultats complets (avec les étapes et la couleur)</li>
<li>On demande l&#39;export des résultats au format html et au format junit</li>
</ul>

<p>Lorsqu&#39;on utilise un profil, on peut lancer pour un tag donné. Exemple : <code>cucumber . --tag @test -p chrome</code></p>

<p>Viennent ensuite les profils :</p>

<ul>
<li>-p default: lance les tests sur firefox</li>
<li>-p danger: autorise le lancement des tests taggués @danger</li>
<li>-p ie, ff, chrome, mobile: lance les tests sur un navigateur particulier</li>
</ul>

<h3>Différences entre les navigateurs</h3>

<p>Passer le nom du navigateur ne suffit pas, il faut également l&#39;utiliser dans le code pour travailler avec le navigateur voulu.</p>

<p>Dans notre cas, nous lancons le navigaeur avant chaque scénario pour éviter qu&#39;un test ait un impact sur le suivant.</p>

<p>Voici le code :</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Before</span> <span class="k">do</span>
  <span class="k">case</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'BROWSER'</span><span class="o">]</span>
  <span class="k">when</span> <span class="s1">'ie'</span>
    <span class="vi">@browser</span> <span class="o">=</span> <span class="no">Watir</span><span class="o">::</span><span class="no">Browser</span><span class="p">.</span><span class="nf">new</span> <span class="ss">:ie</span>
  <span class="k">when</span> <span class="s1">'mobile'</span>
    <span class="n">mobile_useragent</span> <span class="o">=</span> <span class="s2">"Mozilla/5.0 (iPhone; CPU iPhone OS 5_1_1 like \
        Mac OS X) AppleWebKit/534.46 (KHTML, like Gecko) Version/5.1 \
        Mobile/9B206 Safari/7534.48.3"</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Firefox</span><span class="o">::</span><span class="no">Profile</span><span class="p">.</span><span class="nf">new</span>
    <span class="n">profile</span><span class="o">[</span><span class="s1">'general.useragent.override'</span><span class="o">]</span> <span class="o">=</span> <span class="n">mobile_useragent</span>
    <span class="vi">@browser</span> <span class="o">=</span> <span class="no">Watir</span><span class="o">::</span><span class="no">Browser</span><span class="p">.</span><span class="nf">new</span> <span class="ss">:firefox</span><span class="p">,</span> <span class="ss">:profile</span> <span class="o">=&gt;</span> <span class="n">profile</span>
  <span class="k">when</span> <span class="s1">'chrome'</span>
    <span class="vi">@browser</span> <span class="o">=</span> <span class="no">Watir</span><span class="o">::</span><span class="no">Browser</span><span class="p">.</span><span class="nf">new</span> <span class="ss">:chrome</span>
  <span class="k">else</span>
    <span class="c1"># Default case : firefox</span>
    <span class="n">download_directory</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="no">Dir</span><span class="p">.</span><span class="nf">pwd</span><span class="si">}</span><span class="s2">/downloads"</span>
    <span class="n">download_directory</span><span class="p">.</span><span class="nf">gsub!</span><span class="p">(</span><span class="s2">"/"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">"</span><span class="p">)</span> <span class="p">\</span>
        <span class="k">if</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Platform</span><span class="p">.</span><span class="nf">windows?</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Firefox</span><span class="o">::</span><span class="no">Profile</span><span class="p">.</span><span class="nf">new</span>
    <span class="n">profile</span><span class="o">[</span><span class="s1">'browser.download.folderList'</span><span class="o">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">profile</span><span class="o">[</span><span class="s1">'browser.download.dir'</span><span class="o">]</span> <span class="o">=</span> <span class="n">download_directory</span>
    <span class="n">profile</span><span class="o">[</span><span class="s1">'browser.link.open_newwindow'</span><span class="o">]</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">profile</span><span class="o">[</span><span class="s1">'browser.helperApps.neverAsk.saveToDisk'</span><span class="o">]</span> <span class="o">=</span> <span class="p">\</span>
        <span class="s2">"application/octet-stream"</span>
    <span class="n">profile</span><span class="o">[</span><span class="s1">'network.http.use-cache'</span><span class="o">]</span> <span class="o">=</span> <span class="kp">false</span>
    <span class="vi">@browser</span> <span class="o">=</span> <span class="no">Watir</span><span class="o">::</span><span class="no">Browser</span><span class="p">.</span><span class="nf">new</span> <span class="ss">:firefox</span><span class="p">,</span> <span class="ss">:profile</span> <span class="o">=&gt;</span> <span class="n">profile</span>
  <span class="k">end</span>
  <span class="c1"># Resize window</span>
  <span class="k">if</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'BROWSER'</span><span class="o">]</span> <span class="o">!=</span> <span class="s1">'mobile'</span>
    <span class="vi">@browser</span><span class="p">.</span><span class="nf">window</span><span class="p">.</span><span class="nf">resize_to</span><span class="p">(</span><span class="mi">1100</span><span class="p">,</span> <span class="mi">900</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="vi">@browser</span><span class="p">.</span><span class="nf">window</span><span class="p">.</span><span class="nf">resize_to</span><span class="p">(</span><span class="mi">640</span><span class="p">,</span> <span class="mi">960</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>On exploite le nom du navigateur pour lancer le bon, avec des paramètres particuliers.</p>

<ul>
<li>Le mobile lance un Firefox avec le profil d&#39;un navigateur Iphone (et une résolution de classique pour un mobile)</li>
<li>Pour internet explorer et chrome, il faut avoir téléchargé les exécutables (sur le groupe selenium) et les avoir ajoutés au path</li>
<li>Pour firefox, on ajoute des paramètres pour effectuer des tests d&#39;upload et download de fichiers)</li>
</ul>

<h3>Les tests ont-ils changés ?</h3>

<p>Lorsque j&#39;ai commencé à coder ces tests, il y a plus d&#39;un an, j&#39;avais anticipé l&#39;architecture pour gérer ce genre de problématique. La mise en place n&#39;a pourtant pas eu lieu sans douleur.</p>

<p>Certains navigateurs ne se comportent pas tout à fait comme les autres. Il faut donc mettre à jour son code pour qu&#39;il soit le plus &quot;ré utilisable possible&quot;.</p>

<p>Dans le cas d&#39;Internet Explorer, les modifications apportées :</p>

<ul>
<li>Ajout d&#39;un tag @ie sur les tests compatibles (et stables) avec IE.</li>
<li>Dans certains cas de remplissage de formulaire, ajout d&#39;une ligne de code pour donner le focus au champ à remplir</li>
<li>Modification des timeout du projet.</li>
</ul>

<p>On lance donc les tests pour Internet Explorer avec la commande <code>cucumber --tag @ie -p ie</code>. On peut changer le tag, mais certains ne fonctionnent pas encore sous IE à cause de codes vraiment spécifiques.</p>

<p>Voici deux exemples de code modifé spécifiquement pour IE :</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">if</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'BROWSER'</span><span class="o">]</span> <span class="o">==</span> <span class="s1">'ie'</span>
  <span class="c1"># internet explorer is slower : timeout increase</span>
  <span class="no">SHORT_TIMEOUT</span> <span class="o">=</span> <span class="mi">5</span>
  <span class="no">TIMEOUT</span> <span class="o">=</span> <span class="mi">15</span>
  <span class="no">LONG_TIMEOUT</span> <span class="o">=</span> <span class="mi">25</span>
<span class="k">else</span>
  <span class="no">SHORT_TIMEOUT</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="no">TIMEOUT</span> <span class="o">=</span> <span class="mi">9</span>
  <span class="no">LONG_TIMEOUT</span> <span class="o">=</span> <span class="mi">25</span>
<span class="k">end</span>
</code></pre></div>
<p>Ce code définit les constantes des timeout pour l&#39;ensemble des test.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">if</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'BROWSER'</span><span class="o">]</span> <span class="o">==</span> <span class="s1">'ie'</span>
  <span class="nb">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># need for IE purpose</span>
<span class="k">end</span>
<span class="nb">self</span><span class="p">.</span><span class="nf">wait_until</span><span class="p">(</span><span class="no">LONG_TIMEOUT</span><span class="p">){</span>
  <span class="nb">self</span><span class="p">.</span><span class="nf">login_element</span><span class="p">.</span><span class="nf">exists?</span> <span class="n">and</span> <span class="nb">self</span><span class="p">.</span><span class="nf">login_element</span><span class="p">.</span><span class="nf">visible?</span>
<span class="p">}</span>
<span class="nb">self</span><span class="p">.</span><span class="nf">username_element</span><span class="p">.</span><span class="nf">focus</span> <span class="c1"># need for IE purpose</span>
<span class="nb">self</span><span class="p">.</span><span class="nf">username</span> <span class="o">=</span> <span class="vi">@account</span><span class="p">.</span><span class="nf">email</span>
</code></pre></div>
<p>Les commentaires dans le code parlent d&#39;eux mêmes. Documenter le code spécifique à IE est d&#39;ailleurs indispensable si on veut garder ses modifications qui semblent &quot;inutiles&quot;.</p>

<p>Si les tests avec Firefox sont joués chaque jour sur un serveur, en 2h45 environ, ceux pour IE sont exécutés en local, en 3h, alors que certains tests ne sont pas exécutés sur IE.</p>

<p>Ce sont donc plus de 300 scénarios par jour, 12 000 par mois. Sans compter les tests unitaires, les tests manuels...</p>
</div>
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page5">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page3">Newer</a>
    
  
</div>

    </div>

  <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
  <script type="text/javascript" src="/public/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/public/js/script.js"></script>
  </body>
</html>
