<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr-fr" itemscope="" itemtype="http://schema.org/Blog">
  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; frame-src 'self' https://apis.google.com https://accounts.google.com; script-src 'self' http://code.jquery.com http://www.google-analytics.com https://apis.google.com; img-src 'self' http://www.google-analytics.com">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="description" content="Blog sur la qualité web en général, et l'automatisation de test web en particulier. Responsable tests et qualité web depuis 7 ans." />
  <meta name="keywords" content="test, watir, qualité, cucumber, jenkins, bug, selenium, appium, bournisien" />
  <meta name="robots" content="index,follow" />


  
    <title>Je teste donc je suis - Journal d'un testeur</title>
    <meta property="og:title" content="Je teste donc je suis" />
    <meta property="og:url" content="https://blog.fabricebournisien.eu/" />
    <meta property="og:type" content="website" />
  


  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">

  <!-- Icons -->
  <link rel="shortcut icon" type="image/png" href="/public/qualite-min.jpg">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <link rel="stylesheet" href="/public/fancybox/jquery.fancybox.css" type="text/css" media="screen" />

  <meta property="og:image"  content="/public/pictures/web-qualite.jpg"/>
  <meta itemprop="image"     content="/public/pictures/web-qualite.jpg" />
  <meta name="twitter:image" content="/public/pictures/web-qualite.jpg" />  
</head>

  <body class="theme-base-0c layout-reverse">
    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Je teste donc je suis
        </a>
      </h1>
      <p class="lead">Blog d'un automatiseur de tests web.</p>
    </div>

    <nav class="sidebar-nav">
      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/archive/">Archives</a>
          
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
	  <a class="sidebar-nav-item" href="http://www.fabricebournisien.eu">CV</a>
	  <!-- SiteSearch Google --> 
	  <form method="get" action="http://www.google.com/search"> 
		<input type="hidden" name="ie" value="UTF-8" /> 
		<input type="hidden" name="oe" value="UTF-8" /> 
		<input type="hidden" name="domains" value="blog.fabricebournisien.eu" /> 
		<input type="hidden" name="sitesearch" value="blog.fabricebournisien.eu" checked="checked" />
		<input type="text" name="q" size="18" maxlength="255" value="" title="Chercher sur le blog" />
		<input type="submit" name="btnG" value="Chercher" /> 
	  </form>
	  <!-- SiteSearch Google -->
    </nav>

    <p>&copy; 2019 - <a href="https://plus.google.com/104493142924184161356" rel="author">Fabrice Bournisien</a></p>
  </div>
</div>

    <div class="content container">
      <div class="posts">
  
  <div class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
    <h2 class="post-title" itemprop="name">
      <a href="/2016/06/04/important-est-le-paradigme/" itemprop="url" rel="bookmark">
        L'important, c'est le paradigme
      </a>
    </h2>

	<span class="post-date">
		<time class="date" datetime="2016-06-04" itemprop="datePublished">
			
			4
			juin
			  
			2016
		</time>
		- par Fabrice Bournisien
		
		- <a href="/tag/ruby">Ruby</a>
		
		- <a href="/tag/python">Python</a>
		
		- <a href="/tag/selenium">Selenium</a>
		
		- <a href="/tag/watir">Watir</a>
		
	</span>

	<div itemprop="ArticleBody"><h3>Technologie de tests</h3>

<p>Dans le passé, j&#39;ai travaillé avec webtest, selenium en 2007/2008, mais ils ne me suffisaient pas. J&#39;avais donc une stack classique depuis 5 ans déjà, améliorée de temps en temps par l&#39;ajout d&#39;une librairie ou une organisation de code différente.</p>

<ul>
<li>Scenario : Cucumber</li>
<li>Code : Ruby</li>
<li>Navigateur : Watir-webdriver</li>
<li>Framework : page-object</li>
<li>Mobile : appium, avec vrais android et xcode simulator pour iOS</li>
<li>Serveur : Jenkins</li>
<li>Autres technologies : applytools, http-server, ... </li>
</ul>

<p>A plusieurs reprises, j&#39;ai hésité à changer de langage, mais cela voulait aussi dire de changer l&#39;ensemble du code actuel pour changer de langage, avoir accès à des choses qui n&#39;existent pas, ou pour faciliter les recrutements. Trouver des développeurs ruby n&#39;est pas toujours facile, en passant à java, ils sont plus nombreux par exemple. Ayant même des développeurs java dans les équipes de développement, on aurait pu avoir des appuis en cas de charge momentanée de travail.</p>

<p>Je n&#39;ai jamais franchi le cap de changer cette stack, qu&#39;on arrivait à adapter et exploiter de mieux en mieux avec le temps. Former mes nouveaux collègues me paraissait simple, et était &quot;facile&quot; parce que tout était logique pour moi. Ils comprenaient vite, posaient des questions parfois pertinentes.</p>

<p>Il m&#39;est arrivé de dire qu&#39;on n&#39;avait pas fait comme il pensait, parce qu&#39;on avait du passif, qui imposait tel ou tel gestion particulière dans un cas précis, qui avait disparu depuis. Ou comment lever une refacto pour simplifier du code en parlant &quot;à bâtons rompus&quot; autour de la stack actuelle.</p>

<h3>Nouvelle stack</h3>

<p>Fin 2015, nous étions une équipe qualité de 6 personnes, codant des tests automatiques.
En janvier 2016, j&#39;ai changé de société. 
Dans la nouvelle, j&#39;ai le même rôle : j&#39;automatise des tests pour assurer la qualité, éviter les bugs, supprimer les régressions à chaque mise en production, etc.</p>

<p>Cette société utilise beaucoup de langage, et j&#39;ai décidé de me mettre un challenge en plus : m&#39;adapter à un des langages utilisés en interne, pour faciliter les interactions en internes : si un développeur veut me filer un coup de main, il peut plus facilement. Etant seul à l&#39;automatisation, si je suis en vacances et qu&#39;un problème survient, ils auront des gens capables de lire les erreurs de code et de débugguer / tenir à jour si c&#39;est urgent.</p>

<ul>
<li>Scenario : behave</li>
<li>Code : Python</li>
<li>Navigateur : Selenium-webdriver2</li>
<li>Framework : page-object</li>
<li>Mobile : pour le moment, simulateur dans chrome via les user-agents</li>
<li>Serveur : Jenkins</li>
<li>Autres technologies : aucune pour le moment</li>
</ul>

<p>On voit que c&#39;est très proche : </p>

<ul>
<li>Cucumber et behave sont pareils, avec quelques subtilités. Par exemple, je n&#39;ai pas trouvé de solution pour tagguer différement des exemples de scenarios outlines.</li>
<li>Watir et selenium se ressemblent beaucoup. Je préfère parfois la syntaxe et la facilité de watir/ruby, qui me permet d&#39;écrire <code>browser.div(class: &#39;maClasse&#39;).span(index: 1)</code> au lieu de selenium/python qui donne <code>browser.find_element_by_class_name(&#39;maClasse&#39;).find_elements_by_tag_name(&#39;span&#39;)[1]</code></li>
<li>Le page object de python me parait moins abouti (et moins utile) que celui de ruby. Je n&#39;utilise au final qu&#39;une partie de ses possibilités, le reste étant déjà gérées par l&#39;organisation de code de behave.</li>
</ul>

<p>Il m&#39;a fallu plusieurs semaines pour arriver à coder du python aussi propre que je le souhaitais, quelques jours pour coder en selenium sans penser à watir.</p>

<p>C&#39;est surtout un changement de mentalité, comme quand on change de langue entre français et anglais : on ne traduit pas littéralement, il faut changer sa façon de penser.</p>

<p>Cela étant, garder quelques points figés, comme les scenarios en BDD (behaviour driven development) m&#39;a permis de gagner beaucoup de temps, de savoir où je voulais aller, ce dont j&#39;avais besoin, pour faciliter la transition.</p>

<p>Le paradigme reste le même : avoir des cas de tests simples, découpés, qui permettent de tester point par point que l&#39;interface utilisateur réagit comme prévu.</p>
</div>
  </div>
  
  <div class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
    <h2 class="post-title" itemprop="name">
      <a href="/2015/09/28/empirique-service-tests/" itemprop="url" rel="bookmark">
        L'empirique au service des tests
      </a>
    </h2>

	<span class="post-date">
		<time class="date" datetime="2015-09-28" itemprop="datePublished">
			
			28
			septembre
			  
			2015
		</time>
		- par Fabrice Bournisien
		
		- <a href="/tag/webdriver">Webdriver</a>
		
		- <a href="/tag/proxy">Proxy</a>
		
	</span>

	<div itemprop="ArticleBody"><h3>Contexte</h3>

<p>Je travaille souvent à tester des comportements liés à la vidéo. Vérifier qu&#39;elle se déroule bien, qu&#39;elle se finit au moment voulu, que les interactions sont possibles.
Une des problématiques est de pouvoir vérifier que les évenements de tracking (statistiques, etc.) sont bien envoyés au bon moment.</p>

<p>Dans mon cas, chaque événement est un appel à un pixel précis, avec un tas de paramètres. L&#39;intérêt pour l&#39;utilisateur est de pouvoir vérifier le fonctionnement, et par exemple déterminer si les utilisateurs qui mettent en pause à un moment relancent la vidéo pour la regarder jusqu&#39;au bout.</p>

<p>Lorsqu&#39;on teste ce genre de chose manuellement, il suffit d&#39;ouvrir la console réseau du navigateur, et de vérifier que les urls sont bien appelées au bon moment.</p>

<h3>Industrialisation</h3>

<p>Dans mon cas, j&#39;ai besoin d&#39;effectuer une centaine de contrôles de ce type, sur différents navigateurs, tous les jours. L&#39;ensemble des tests étant écrit en ruby / watir-webdriver, j&#39;ai longtemps chercher une solution permettant via webdriver de vérifier ce qui passait au niveau réseau. </p>

<p>J&#39;ai envisagé un temps de démarrer mes navigateurs en leur ajoutant un plugin : webdriver permet de le faire à la volée avec le fichier xpi. Mais cela ne marche pas pour Internet Explorer, que je ne peux pas exclure des tests.</p>

<p>Après des semaines de réflexions, par une nuit d&#39;insomnie, j&#39;ai trouvé une solution:</p>

<ul>
<li>Installer un proxy sur le serveur de tests</li>
<li>Analyser les logs de ce proxy pour mes besoins</li>
</ul>

<p>Le choix du proxy était &quot;limité&quot; avec de nombreuses contraintes : </p>

<ul>
<li>Besoin d&#39;avoir un fichier de logs</li>
<li>Besoin de pouvoir le contrôler en ruby (ou dans un navigateur)</li>
<li>Besoin de fonctionner sur windows et mac</li>
</ul>

<p>Mon choix s&#39;est porté vers <a href="http://www.charlesproxy.com/">Charles proxy</a>.</p>

<p>Le fichier de log de charles étant horodaté, nous avons pu comparer les événements les uns par rapport aux autres. Pour vérifier, par exemple, que l&#39;evenement &quot;50%&quot; se produit à la moitié de la durée de la vidéo.</p>

<p>Il a suffit d&#39;ajouter des urls bien reconnaissables pour toutes nos vidéos de tests et de se retrousser les manches.</p>

<h3>Problèmes</h3>

<p>Durant la mise en place de cette solution (et sa maintenance), nous avons rencontrés plusieurs problèmes :</p>

<ul>
<li>Nécessité, pour chaque scénario, de redémarrer le proxy. Il est gourmand en ressources (mémoire principalement), et nos centaines de tests journaliers le mettent à rude épreuve.</li>
<li>Lors d&#39;un test où nous en avons besoin, il faut pour l&#39;analyser ouvrir un navigateur, télécharger le fichier de log (format CSV), filter les lignes utiles, etc. Cela est couteux en temps. Le fichier de log pèse environ 1mo à chaque fois. Cela est couteux en temps.</li>
<li>Les tests de vidéo sur mobile rencontrent parfois des lenteurs, ce qui compliquent l&#39;analyse des écarts de temps.</li>
<li>Le format du fichier de log (en particulier les dates) est différent enttre windows et mac.</li>
<li>Cela empêche la paralélisation sur une même serveur.</li>
</ul>

<h3>Bénéfices</h3>

<p>Malgré ces défauts, ce système nous convenait parfaitement.</p>

<p>Il nous a permis d&#39;industrialiser des tests sur un point clé de certains projets, sur tous les navigateurs, y compris sur mobile.</p>

<p>Lorsqu&#39;un nouveau collègue est arrivé dans l&#39;équipe en juillet, et que je lui ai présenté cette brique bien pratique, il a trouvé ça intéressant, et trouvait l&#39;idée originale.</p>

<h3>On prend les mêmes et on recommence, mais pas tout à fait</h3>

<p>Quelques mois plus tard, lors d&#39;une discussion avec un collègue sans aucun rapport, j&#39;ai eu une meilleure idée.
Objectifs: </p>

<ul>
<li>Diminuer le temps d&#39;initialisation</li>
<li>Simplifier le code (et donc faciliter la maintenance)</li>
</ul>

<p>Plutôt que d&#39;analyser le départ de tous les pixels, on inverse la pensée. Comme dans la vraie vie, il faut que nous ayons notre propre serveur web, qui récupère les appels à des pixels, et il nous faut &quot;juste&quot; analyser les logs de ce serveur.
C&#39;est là qu&#39;entre en scène node.js, et et plus précisement son http-server.</p>

<p>Dans un dossier proxy, on créer un fichier html. On édite les urls de pixels de toutes nos vidéos de tests, pour appeler le serveur local http://127..0.0.1:8080/track.htm?action=pause&amp;id=123456</p>

<p>Ensuite, la ligne de commande <code>http-server proxy/ --cors -a 127.0.0.1 &gt;&gt; proxy/log.txt</code> permet de lancer le serveur localement, et d&#39;avoir le log dans un fichier lui même accessible sur le serveur.</p>

<p>Pour l&#39;analyse du log, il est disponible via une véritable url, donc on gagne du temps : pas besoin d&#39;ouvrir un navigateur comme avec le log de charles.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">url</span> <span class="o">=</span> <span class="s2">"http://127.0.0.1:8080/log.txt"</span>
<span class="n">content</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="no">URI</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">url</span><span class="p">))</span></code></pre></div>

<h3>Bénéfices</h3>

<p>Quand j&#39;ai commencé cette modification, j&#39;espérais gagner un peu de temps. 
Nous avions à ce moment là environ 100h de tests, et pour certains projets, je n&#39;attendais pas de gros gains. Et puis, j&#39;ai fait les calculs. </p>

<ul>
<li>Quelques centaines de scenarios n&#39;ont plus besoin du tout d&#39;initialisation. 10 à 15 secondes à chaque fois sur windows.</li>
<li>Le fichier de log (1 Mo / scenario auparavant) a fortement diminué. Puisqu&#39;on ne log plus que ce qui est utile, on gagne plus de 99% de taille de fichier de log.</li>
<li>La non ouverture du navigateur pour télécharger le fichier de log fait également gagner beaucoup de temps.</li>
</ul>

<p>Première estimation : environ 4h de gagnées parmi les 100h de tests.</p>

<p>Lors des premiers tests, sur mon mac, j&#39;ai eu l&#39;impression que mes calculs sous estimaient les gains. On a en fait avoisiné les 6h30 de gain.</p>

<p>Après analyses et contrôles, quelques pistes supplémentaires pour expliquer ces gains en plus:</p>

<ul>
<li>Sans proxy, les pages s&#39;affichent un tout petit peu plus vite. Non perceptible à l&#39;oeil humain, mais vu la quantité de pages de nos batteries de tests, c&#39;est sensible.</li>
<li>La mémoire vive libérée par ce changement sur les serveurs windows peut être utilisée par le serveur à autre chose de &quot;plus utile&quot; pour les tests.</li>
</ul>

<p>C&#39;est finalement une clef primordiale quand on met en place des tests sur de gros projets: il faut tester brique par brique, et améliorer la solidité et la couvertue de façon empirique.</p>
</div>
  </div>
  
  <div class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
    <h2 class="post-title" itemprop="name">
      <a href="/2015/01/15/kiss-simple-n-est-pas-toujours-simple/" itemprop="url" rel="bookmark">
        La simplicité n'est pas toujours simple
      </a>
    </h2>

	<span class="post-date">
		<time class="date" datetime="2015-01-15" itemprop="datePublished">
			
			15
			janvier
			  
			2015
		</time>
		- par Fabrice Bournisien
		
		- <a href="/tag/qualite">Qualite</a>
		
		- <a href="/tag/ruby">Ruby</a>
		
	</span>

	<div itemprop="ArticleBody"><p>Comme je le disais il y a peu, sur les gros projets, il est intéressant de <a href="/2014/12/13/kiss-simple-et-efficace/">surveiller la simplicité</a> du code.
J&#39;utilise pour cela <a href="https://rubygems.org/gems/flog">flog</a> qui calcule la complexité des méthodes.</p>

<h3>Zone grise</h3>

<p>Sur notre projet actuel, le score total flog est de plus de 6300 points de complexité d&#39;après flog. Avec une moyenne de 12.7 et un maximum de 206.5, le champ est large.</p>

<p>Répartition des plus hauts scores: </p>

<ul>
<li>&gt; 200 : 1 fonction</li>
<li>&gt; 100 : 3 fonctions</li>
<li>&gt; 50 : 16 fonctions</li>
<li>&gt; 20 : 41 fonctions</li>
<li>&lt; 20 : un peu plus de 400.</li>
</ul>

<p>Evidemment, quand je cherche à simplifier, je commence à regarder les fonctions les plus complexes. Il est souvent plus facile de simplifier une chose compliquée qu&#39;une chose déjà simple.</p>

<p>Il est pourtant très difficile de savoir quelle est la limite acceptable. Selon les gens, et les projets, cela varie entre 25 et 60.
On définit par conséquent une zone grise, contenant les fonctions &quot;à vérifier&quot; et à simplifier si possible, au cas par cas.</p>

<p>Au dessus, il faut bien évidemment faire quelque chose. En dessous, c&#39;est peu utile. J&#39;ai donc encore quelques fonctions bien tordues à simplifier sur le projet, pour respecter cette règle à la lettre.</p>

<h3>Complexe ou compliqué ?</h3>

<p>J&#39;ai enquêté sur une fonction particulière, assez longue, qui vérifie la présence d&#39;un élément particulier. Cet élément varie en fonction du type de page que l&#39;on teste.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">format_is_present</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
    <span class="k">case</span> <span class="p">(</span><span class="nb">format</span><span class="p">.</span><span class="nf">downcase</span><span class="p">)</span>
    <span class="k">when</span> <span class="s1">'bt'</span>
        <span class="n">expect</span><span class="p">(</span><span class="vi">@browser</span><span class="p">.</span><span class="nf">divs</span><span class="p">(</span><span class="ss">class: </span><span class="s1">'wtr'</span><span class="p">).</span><span class="nf">length</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">expect</span><span class="p">(</span><span class="vi">@browser</span><span class="p">.</span><span class="nf">divs</span><span class="p">(</span><span class="ss">class: </span><span class="s1">'wtl'</span><span class="p">).</span><span class="nf">length</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">when</span> <span class="s1">'bc'</span>
        <span class="vi">@browser</span><span class="p">.</span><span class="nf">send_keys</span> <span class="ss">:space</span>
        <span class="n">expect</span><span class="p">(</span><span class="vi">@browser</span><span class="p">.</span><span class="nf">iframe</span><span class="p">(</span><span class="ss">id: </span><span class="s1">'ei0'</span><span class="p">).</span><span class="nf">divs</span><span class="p">(</span><span class="ss">id: </span><span class="s1">'ep0'</span><span class="p">).</span><span class="nf">length</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">when</span> <span class="s1">'ib'</span>
        <span class="nb">sleep</span><span class="p">(</span><span class="no">SHORT_TIMEOUT</span><span class="p">)</span>
        <span class="n">expect</span><span class="p">(</span><span class="vi">@browser</span><span class="p">.</span><span class="nf">divs</span><span class="p">(</span><span class="ss">id: </span><span class="s1">'ebib'</span><span class="p">).</span><span class="nf">length</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">when</span> <span class="s1">'ic'</span>
        <span class="n">expect</span><span class="p">(</span><span class="vi">@browser</span><span class="p">.</span><span class="nf">divs</span><span class="p">(</span><span class="ss">id: </span><span class="s1">'bc'</span><span class="p">).</span><span class="nf">length</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">when</span> <span class="s1">'ifw'</span>
        <span class="n">expect</span><span class="p">(</span><span class="vi">@browser</span><span class="p">.</span><span class="nf">divs</span><span class="p">(</span><span class="ss">id: </span><span class="s1">'bc'</span><span class="p">).</span><span class="nf">length</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">when</span> <span class="s1">'ift'</span>
        <span class="n">expect</span><span class="p">(</span><span class="vi">@browser</span><span class="p">.</span><span class="nf">divs</span><span class="p">(</span><span class="ss">class: </span><span class="s1">'wf'</span><span class="p">).</span><span class="nf">length</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">when</span> <span class="s1">'ir'</span>
        <span class="vi">@browser</span><span class="p">.</span><span class="nf">send_keys</span> <span class="ss">:space</span>
        <span class="nb">sleep</span><span class="p">(</span><span class="no">SHORT_TIMEOUT</span><span class="p">)</span>
        <span class="n">expect</span><span class="p">(</span><span class="vi">@browser</span><span class="p">.</span><span class="nf">divs</span><span class="p">(</span><span class="ss">id: </span><span class="s1">'en'</span><span class="p">).</span><span class="nf">length</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">when</span> <span class="s1">'ise'</span>
        <span class="n">expect</span><span class="p">(</span><span class="vi">@browser</span><span class="p">.</span><span class="nf">divs</span><span class="p">(</span><span class="ss">class: </span><span class="s1">'bm'</span><span class="p">).</span><span class="nf">length</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">when</span> <span class="s1">'iso'</span>
        <span class="vi">@browser</span><span class="p">.</span><span class="nf">send_keys</span> <span class="ss">:space</span>
        <span class="nb">sleep</span><span class="p">(</span><span class="no">SHORT_TIMEOUT</span><span class="p">)</span>
        <span class="n">expect</span><span class="p">(</span><span class="vi">@browser</span><span class="p">.</span><span class="nf">divs</span><span class="p">(</span><span class="ss">id: </span><span class="s1">'ep0'</span><span class="p">).</span><span class="nf">length</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">when</span> <span class="s1">'ise'</span>
        <span class="nb">sleep</span><span class="p">(</span><span class="no">SHORT_TIMEOUT</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="vi">@browser</span><span class="p">.</span><span class="nf">div</span><span class="p">(</span><span class="ss">class: </span><span class="s1">'ebt'</span><span class="p">).</span><span class="nf">exists?</span><span class="p">)</span>
            <span class="n">expect</span><span class="p">(</span><span class="vi">@browser</span><span class="p">.</span><span class="nf">divs</span><span class="p">(</span><span class="ss">class: </span><span class="s1">'ebt'</span><span class="p">).</span><span class="nf">length</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span>
            <span class="n">expect</span><span class="p">(</span><span class="vi">@browser</span><span class="p">.</span><span class="nf">divs</span><span class="p">(</span><span class="ss">class: </span><span class="s1">'et'</span><span class="p">).</span><span class="nf">length</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">end</span>
    <span class="k">when</span> <span class="s1">'it'</span>
        <span class="nb">sleep</span><span class="p">(</span><span class="no">SHORT_TIMEOUT</span><span class="p">)</span>
        <span class="n">expect</span><span class="p">(</span><span class="vi">@browser</span><span class="p">.</span><span class="nf">divs</span><span class="p">(</span><span class="ss">class: </span><span class="s1">'wtr'</span><span class="p">).</span><span class="nf">length</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">expect</span><span class="p">(</span><span class="vi">@browser</span><span class="p">.</span><span class="nf">divs</span><span class="p">(</span><span class="ss">class: </span><span class="s1">'wtl'</span><span class="p">).</span><span class="nf">length</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span>
        <span class="nb">puts</span> <span class="s2">"Format </span><span class="si">#{</span><span class="nb">format</span><span class="si">}</span><span class="s2"> Not yet implemented"</span>
        <span class="k">return</span> <span class="s2">"pending"</span>
    <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Score flog : 135.8. </p>

<p>Vraiment pas terrible, mais le nombre de cas différents ne simplifie pas la tâche.</p>

<h4>Premier essai : Yaml et algorithme</h4>

<p>J&#39;ai commencé par créer un fichier yaml contenant toutes les informations des tests, pour n&#39;avoir ensuite qu&#39;un algorithme commun à tous les cas.</p>

<p>Voici le code ruby de la fonction ainsi modifié:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">format_is_present_with_yaml</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
    <span class="n">which</span> <span class="o">=</span> <span class="nb">format</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="s1">' '</span><span class="p">,</span> <span class="s1">'_'</span><span class="p">).</span><span class="nf">downcase</span>
    <span class="c1"># Get checkers from the yaml</span>
    <span class="no">CONTROLS</span> <span class="o">=</span> <span class="no">YAML</span><span class="p">.</span><span class="nf">load_file</span><span class="p">(</span><span class="s1">'support/checkers.yml'</span><span class="p">)[</span><span class="s1">'controls'</span><span class="p">]</span>
    <span class="n">checks</span> <span class="o">=</span> <span class="no">CONTROLS</span><span class="p">[</span><span class="n">which</span><span class="p">]</span>
    <span class="k">if</span> <span class="o">!</span><span class="n">checks</span><span class="p">.</span><span class="nf">nil?</span>
        <span class="n">checks</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span> <span class="n">_key</span><span class="p">,</span> <span class="n">check</span> <span class="o">|</span>
            <span class="c1"># extra command</span>
            <span class="k">if</span> <span class="o">!</span><span class="n">check</span><span class="p">[</span><span class="s1">'extra'</span><span class="p">].</span><span class="nf">nil?</span>
                <span class="k">if</span> <span class="n">check</span><span class="p">[</span><span class="s1">'extra'</span><span class="p">].</span><span class="nf">to_s</span> <span class="o">==</span> <span class="s1">'sleep'</span>
                    <span class="nb">sleep</span><span class="p">(</span><span class="no">SHORT_TIMEOUT</span><span class="p">)</span>
                <span class="k">elsif</span> <span class="n">check</span><span class="p">[</span><span class="s1">'extra'</span><span class="p">].</span><span class="nf">to_s</span> <span class="o">==</span> <span class="s1">'scroll'</span>
                    <span class="vi">@browser</span><span class="p">.</span><span class="nf">send_keys</span> <span class="ss">:space</span>
                <span class="k">elsif</span> <span class="n">check</span><span class="p">[</span><span class="s1">'extra'</span><span class="p">].</span><span class="nf">to_s</span> <span class="o">==</span> <span class="s1">'both'</span>
                    <span class="nb">sleep</span><span class="p">(</span><span class="no">SHORT_TIMEOUT</span><span class="p">)</span>
                    <span class="vi">@browser</span><span class="p">.</span><span class="nf">send_keys</span> <span class="ss">:space</span>
                <span class="k">end</span>
            <span class="k">end</span>

            <span class="c1"># Check in a frame is slightly different</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">check</span><span class="p">[</span><span class="s1">'in_frame'</span><span class="p">].</span><span class="nf">nil?</span><span class="p">)</span>
                <span class="n">b</span> <span class="o">=</span> <span class="vi">@browser</span>
            <span class="k">else</span>
                <span class="n">b</span> <span class="o">=</span> <span class="vi">@browser</span><span class="p">.</span><span class="nf">iframe</span><span class="p">(</span><span class="ss">id: </span><span class="n">check</span><span class="p">[</span><span class="s1">'in_frame'</span><span class="p">])</span>
            <span class="k">end</span>

            <span class="c1"># Make the control</span>
            <span class="k">if</span> <span class="n">check</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"class"</span>
                <span class="n">expect</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="nf">divs</span><span class="p">(</span><span class="ss">class: </span><span class="n">check</span><span class="p">[</span><span class="s1">'value'</span><span class="p">]).</span><span class="nf">length</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="n">check</span><span class="p">[</span><span class="s1">'result'</span><span class="p">])</span>
            <span class="k">else</span>
                <span class="n">expect</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="nf">divs</span><span class="p">(</span><span class="ss">id: </span><span class="n">check</span><span class="p">[</span><span class="s1">'value'</span><span class="p">]).</span><span class="nf">length</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="n">check</span><span class="p">[</span><span class="s1">'result'</span><span class="p">])</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">else</span>
        <span class="nb">puts</span> <span class="s2">"Format </span><span class="si">#{</span><span class="nb">format</span><span class="si">}</span><span class="s2"> Not yet implemented"</span>
        <span class="k">return</span> <span class="s2">"pending"</span>
    <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Score flog : 75.3. Score presque divisé par deux : impressionnant. </p>

<p>Par contre, contrairement à la première fonction :</p>

<ul>
<li>Une partie du raisonnement est déporté dans un fichier externe. Si je ne le poste pas, il est impossible de savoir ce que fait l&#39;algo.</li>
<li>Si de nouveaux cas apparaissent, il faudra peut être modifié ce nouvel algorithme, ce qui peut être risqué et ajouter des effets de bords.</li>
<li>Franchement, lisez le code : c&#39;est beaucoup moins clair que la fonction précédente. La gestion des cas particuliers représente la plus grande part du code, noyant complétement la compréhension.</li>
</ul>

<h4>Un compromis</h4>

<p>Autre solution, regrouper les différents cas par lots similaires. </p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">format_is_present_new</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'ib'</span>    <span class="o">=&gt;</span> <span class="s1">'ebib'</span><span class="p">,</span>
        <span class="s1">'ic'</span>    <span class="o">=&gt;</span> <span class="s1">'bc'</span><span class="p">,</span>
        <span class="s1">'ifw'</span>   <span class="o">=&gt;</span> <span class="s1">'bc'</span><span class="p">,</span>
        <span class="s1">'ir'</span>    <span class="o">=&gt;</span> <span class="s1">'en'</span><span class="p">,</span>
        <span class="s1">'is'</span>    <span class="o">=&gt;</span> <span class="s1">'ep0'</span>
    <span class="p">}</span>
    <span class="n">classes</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'ift'</span>   <span class="o">=&gt;</span> <span class="s1">'wf'</span><span class="p">,</span>
        <span class="s1">'is'</span>    <span class="o">=&gt;</span> <span class="s1">'bm'</span><span class="p">,</span>
        <span class="s1">'ise'</span>   <span class="o">=&gt;</span> <span class="sr">/e(|b)t/</span>
    <span class="p">}</span>

    <span class="k">case</span> <span class="p">(</span><span class="nb">format</span><span class="p">.</span><span class="nf">downcase</span><span class="p">)</span>
    <span class="c1"># generic cases with element by id</span>
    <span class="k">when</span> <span class="s1">'ib'</span><span class="p">,</span> <span class="s1">'ic'</span><span class="p">,</span> <span class="s1">'ifw'</span><span class="p">,</span> <span class="s1">'ir'</span><span class="p">,</span> <span class="s1">'is'</span>
        <span class="k">if</span> <span class="sx">%w(ir is)</span><span class="p">.</span><span class="nf">include?</span> <span class="nb">format</span><span class="p">.</span><span class="nf">downcase</span>
            <span class="c1"># generic cases but with scroll</span>
            <span class="vi">@browser</span><span class="p">.</span><span class="nf">send_keys</span> <span class="ss">:space</span>
        <span class="k">end</span>
        <span class="nb">sleep</span><span class="p">(</span><span class="no">SHORT_TIMEOUT</span><span class="p">)</span>
        <span class="n">expect</span><span class="p">(</span><span class="vi">@browser</span><span class="p">.</span><span class="nf">divs</span><span class="p">(</span><span class="ss">id: </span><span class="n">ids</span><span class="p">[</span><span class="nb">format</span><span class="p">]).</span><span class="nf">length</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># generic cases with element by class</span>
    <span class="k">when</span> <span class="s1">'is'</span><span class="p">,</span> <span class="s1">'ift'</span><span class="p">,</span> <span class="s1">'ise'</span>
        <span class="nb">sleep</span><span class="p">(</span><span class="no">SHORT_TIMEOUT</span><span class="p">)</span>
        <span class="n">expect</span><span class="p">(</span><span class="vi">@browser</span><span class="p">.</span><span class="nf">divs</span><span class="p">(</span><span class="ss">class: </span><span class="n">classes</span><span class="p">[</span><span class="nb">format</span><span class="p">]).</span><span class="nf">length</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># particular cases</span>
    <span class="k">when</span> <span class="s1">'bt'</span>
        <span class="n">expect</span><span class="p">(</span><span class="vi">@browser</span><span class="p">.</span><span class="nf">divs</span><span class="p">(</span><span class="ss">class: </span><span class="s1">'wtr'</span><span class="p">).</span><span class="nf">length</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">expect</span><span class="p">(</span><span class="vi">@browser</span><span class="p">.</span><span class="nf">divs</span><span class="p">(</span><span class="ss">class: </span><span class="s1">'wtl'</span><span class="p">).</span><span class="nf">length</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">when</span> <span class="s1">'bc'</span>
        <span class="vi">@browser</span><span class="p">.</span><span class="nf">send_keys</span> <span class="ss">:space</span>
        <span class="n">expect</span><span class="p">(</span><span class="vi">@browser</span><span class="p">.</span><span class="nf">iframe</span><span class="p">(</span><span class="ss">id: </span><span class="s1">'ei0'</span><span class="p">).</span><span class="nf">divs</span><span class="p">(</span><span class="ss">id: </span><span class="s1">'ep0'</span><span class="p">).</span><span class="nf">length</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">when</span> <span class="s1">'intab'</span>
        <span class="nb">sleep</span><span class="p">(</span><span class="no">SHORT_TIMEOUT</span><span class="p">)</span>
        <span class="n">expect</span><span class="p">(</span><span class="vi">@browser</span><span class="p">.</span><span class="nf">divs</span><span class="p">(</span><span class="ss">class: </span><span class="s1">'wtr'</span><span class="p">).</span><span class="nf">length</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">expect</span><span class="p">(</span><span class="vi">@browser</span><span class="p">.</span><span class="nf">divs</span><span class="p">(</span><span class="ss">class: </span><span class="s1">'wtl'</span><span class="p">).</span><span class="nf">length</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span>
        <span class="nb">puts</span> <span class="s2">"Format </span><span class="si">#{</span><span class="nb">format</span><span class="si">}</span><span class="s2"> Not yet implemented"</span>
        <span class="k">return</span> <span class="s2">"pending"</span>
    <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Quelques détails :</p>

<ul>
<li>J&#39;ai regroupé en fonction du type d&#39;element à vérifier : les div filtrés par id, ceux filtrés par class, puis tous les autres cas particuliers.</li>
<li>En écrivant cet article, j&#39;ai trouvé une petite amélioration qui baisse la note flog de quelques points supplémentaires.</li>
<li>Ajouter des nouveux cas sera trivial. Le code reste parfaitement lisible, même pour quelqu&#39;un découvrant le projet.</li>
<li>Le score est toujours au dessus de la zone grise, mais je suis à cours d&#39;idée. Pour le moment.</li>
</ul>

<p>Score flog final : 76.4. Il était de 85 quand j&#39;ai commencé à écrire cet article : merci à vous d&#39;avoir été mon <a href="http://fr.wikipedia.org/wiki/M%C3%A9thode_du_canard_en_plastique">canard en plastique</a></p>
</div>
  </div>
  
  <div class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
    <h2 class="post-title" itemprop="name">
      <a href="/2015/01/07/petits-plaisirs-de-la-vie/" itemprop="url" rel="bookmark">
        Petits plaisirs de la vie
      </a>
    </h2>

	<span class="post-date">
		<time class="date" datetime="2015-01-07" itemprop="datePublished">
			
			7
			janvier
			  
			2015
		</time>
		- par Fabrice Bournisien
		
	</span>

	<div itemprop="ArticleBody"><p>L&#39;année 2014 a été <a href="/2014/09/09/bonne-annee-2014/">longue et difficile</a>. Les vacances de Noël ont failli être du même ordre :</p>

<ul>
<li>Un dimanche à chercher un médecin de garde, pour une bronchite traitée qui a dégénéré.</li>
<li>Une soirée aux urgences pédiatriques pour mon fils avec ses 39.7°C, une nuit à l&#39;hopital, pour pneumopathie.</li>
<li>Une rechute pour mon père, avec infection pulmonaire, un traitement assez lourd.</li>
<li>La moitié de la famille touchée par une gastro... qui finalement a été &quot;légère&quot; avec à peine une journée chacun de &quot;moins bien&quot;</li>
</ul>

<p>Avec tout ce qui s&#39;est passé, j&#39;apprécie d&#39;autant plus les petits bonheurs de la vie :</p>

<ul>
<li>Toute la famille a pu passer le réveillon du 25 ensemble, et tous les enfants se sont éclatés. Mon fils a adoré distribuer les paquets à tout le monde.</li>
<li>Mon père va mieux, et devrait enfin rentrer à la maison dans les prochaines semaines. Depuis le printemps, ca commençait à faire long.</li>
<li>La neige, qui est bien tombée juste après Noël, pour la faire découvrir aux petits. Mais sans gêner la circulation pour autant.</li>
<li>La première bêtise de mon fils (un premier janvier). Sur le coup, je n&#39;étais pas content. Mais maintenant, ça fera un chouette souvenir. Nous aider au restaurant et faire tomber une assiette pleine...</li>
<li>Mon fils se met à vouloir manger comme les grands. Il passe donc de &quot;je ne mange que les plats pour bébés&quot;, sans vouloir gouter aux plats préparés avec amour par sa mère à &quot;je ne veux manger que comme mes parents&quot;.</li>
<li>Mon fils qui accepte enfin de varier les gouts de ses yaourts.</li>
<li>Mon fils qui a fait des progrès énormes dans l&#39;apprentissage du langage. On devine les phrases, on comprend de plus en plus de mots, et il se met à répéter tout ce qu&#39;on dit.</li>
<li>Mon fils qui semble bien comprendre qu&#39;il y aura bientôt un bébé de plus dans la maison.</li>
<li>La grossesse de ma femme, qui avance doucement et surement.</li>
<li>Mon travail, où j&#39;ai assez de temps pour pouvoir effectuer des modifications importantes qui me tiennent à coeur. Et où l&#39;équipe travaille &quot;enfin&quot; en harmonie.</li>
</ul>

<p>Les petits plaisirs de la vie font mon bonheur. N&#39;oubliez jamais vos petits plaisirs.</p>
</div>
  </div>
  
  <div class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
    <h2 class="post-title" itemprop="name">
      <a href="/2014/12/13/kiss-simple-et-efficace/" itemprop="url" rel="bookmark">
        KISS : Keep it simple and stupid
      </a>
    </h2>

	<span class="post-date">
		<time class="date" datetime="2014-12-13" itemprop="datePublished">
			
			13
			décembre
			
			2014
		</time>
		- par Fabrice Bournisien
		
		- <a href="/tag/qualite">Qualite</a>
		
		- <a href="/tag/ruby">Ruby</a>
		
	</span>

	<div itemprop="ArticleBody"><p>Quand on travaille sur des gros projets, on a tendance à rajouter beaucoup de fonctions, de code, partout, à tout bout de champ.
Il faut savoir prendre du recul, pour simplifier le code, et faire des choses simples et efficaces.</p>

<p>Dans le cadre de mon travail, l&#39;équipe test a pas mal changé cet été, avec 2 nouveaux arrivants. Ca tombe bien, on a aussi récupéré des nouveaux projets à tester.
C&#39;est en les formant à nos méthodes, notre code, que j&#39;ai repéré des améliorations à faire, et qu&#39;ils ont fait des suggestions intéressantes.</p>

<p>Avec leur arrivée, une partie de ma charge de travail a pu diminuer un peu, me permettant de réflechir, de me poser des questions, de chercher des idées &quot;innovantes&quot; pour résoudre des problèmes mis de côté par manque de temps depuis des semaines (voire plus).</p>

<h3>Mise en place en 3 clics</h3>

<p>Bon, j&#39;éxagère, il faut plus que 3 clics. L&#39;utilisation d&#39;un Gemfile et de la gem <a href="https://rubygems.org/gems/bundler">bundler</a> permet de simplifier l&#39;ensemble de la procédure.</p>

<p>Pour préparer un nouveau poste (suite à une embauche, une réinstallation, ou un nouveau serveur, il faut alors installer ruby, la gem bundler, récupérer le dépôt du code, puis lancer juste la commande <code>bundle install</code>. 
Et le tour est joué.</p>

<p>Pour aller plus loin : mise en place sur tous les serveurs de tests d&#39;une routine vérifiant que la liste est à jour et conforme à ce qu&#39;on attend, avec un </p>

<div class="highlight"><pre><code class="language-shell" data-lang="shell">bundle update
gem cleanup</code></pre></div>

<h3>L&#39;information, le nerf de la guerre</h3>

<p>Plongés dans les tests, nous disposions de plusieurs documentations, avec des buts plus ou moins précis. Localisées à plusieurs endroits.
Du coup, petit ménage d&#39;été, pour les regrouper, classer, mettre à jour. Au final, on a gardé plusieurs documents, pour plusieurs rôles différents :</p>

<ul>
<li><strong>Documentation du code</strong> : présente depuis le début, avec génération automatique par la gem ruby <a href="https://rubygems.org/gems/rdoc">rdoc</a> et un petit script ruby (basé sur des expressions régulières) pour lister les step_definitons. Basée évidemment sur les commentaires dans le code, qui sont eux mêmes le premier niveau d&#39;explication.</li>
<li><strong>Documentation sur comment coder</strong> : quelques documents précis sur comment installer l&#39;environnement, les conventions de codage, ou des points précis et complexe des tests.</li>
<li><strong>Documentation sur les produits</strong> : nous testons une demie douzaine de projets, plus ou moins liés les uns avec les autres. Pour pouvoir teter efficacement, il vaut mieux savoir comment le projet fonctionne, et dans l&#39;idéal, connaître également les bugs les plus courants sur le projet.</li>
</ul>

<h3>Codes complexes et compliqués</h3>

<p>Aujourd&#39;hui, l&#39;ensemble de nos codes testant les projets de la société représenter environ 11 000 lignes de codes (essentiellement en ruby, cucumber, shell)</p>

<p>Il y a 10 jours, j&#39;ai regardé pour la première fois depuis des mois les résultats de <a href="https://rubygems.org/gems/flog">flog</a> sur le projet. 
Pour résumer, flog analyse le code source, compte combien de fois on effectue chaque &quot;action&quot;, et s&#39;ensuit une note de complexité pour chaque méthode, et pour l&#39;ensemble.</p>

<p>Comme on peut classer, on voit immédiatement les fonctions les plus compliquées. Reste à savoir si la complexité est normale ou non. Après avoir lu pas mal d&#39;articles sur le sujet, et testé moi même sur notre code, j&#39;estime qu&#39;une fonction avec un score supérieur à 50 doit être analysée, et éventuellement, modifiée.</p>

<h4>Quelques chiffres</h4>

<p>J&#39;ai profité d&#39;un &quot;temps calme&quot; au bureau pour bosser sur le sujet. </p>

<p>Avant :</p>

<div class="highlight"><pre><code class="language-shell" data-lang="shell">7128.5: flog total
    15.6: flog/method average

   793.5: main#none
   236.1: main#launch_browser
   197.0: main#get_job_results
   138.0: Then#/^HTML <span class="o">(</span>contain|don<span class="s1">'t contain) (.*)$/
   136.7: Then#/^I don'</span>t see errors<span class="nv">$/</span>
   134.8: FormatPage#format_is_present
   131.1: main#compare_stats
    90.7: Then#/^I click on the insocial <span class="nb">expand</span><span class="nv">$/</span>
    81.4: main#stats_of_day</code></pre></div>

<p>Après : </p>

<div class="highlight"><pre><code class="language-shell" data-lang="shell">6166.2: flog total
    13.8: flog/method average

   827.4: main#none
   197.0: main#get_job_results
   168.0: main#launch_browser
   134.8: FormatPage#format_is_present
    90.7: Then#/^I click on the insocial <span class="nb">expand</span><span class="nv">$/</span>
    90.3: main#compare_stats
    77.0: main#stats_of_day</code></pre></div>

<p>On note plusieurs choses :</p>

<ul>
<li>La note globale a chuté (-14%). </li>
<li>Cela fait mathématiquement baissé la moyenne par méthode.</li>
<li>Certaines méthodes &quot;complexes&quot; ont bien baissé.</li>
<li>D&#39;autres ont augmenté : avec les pull request de mes collègues, rien d&#39;aberrant. La note a donc baissé alors que dans le même temps, plus de 1 500 lignes de code ont été ajoutées / modifiées.</li>
<li>Certaines méthodes, complexes, ont une note qui correspond à leur difficulté de compréhension. </li>
</ul>

<h4>Qu&#39;est ce que j&#39;ai changé ?</h4>

<p>Rien de transcendant :</p>

<ul>
<li>Du code dupliqué a été &quot;mis en commun&quot; pour faciliter la maintenance.</li>
<li>Des optimisations faciles : par exemple, dans une méthode utilisant beaucoup de données, j&#39;ai remplacé l&#39;utilisation d&#39;un tableau par une copie du contenu d&#39;une données. Passer de <code>my_array[&#39;result&#39;][&#39;report&#39;][&#39;url&#39;]</code> à <code>my_url</code> quand c&#39;est utilisé 7-8 fois, ça améliore la complexité et aussi la lisibilité et la maintenabilité.</li>
<li>Des méthodes ont été découpées pour clarifier ce que le code faisait.</li>
</ul>

<h3>Et c&#39;est conventionnel tout ça ?</h3>

<p>En parralèle, j&#39;ai mis à jour la gem <a href="https://rubygems.org/gems/rubocop">rubocop</a>. Cette gem permet de vérifier que toutes les conventions sont respectées. La liste des choses vérifiées s&#39;est beaucoup étoffée depuis la dernière fois que j&#39;avais mis à jour la gemme (de 0.18.1 à 0.27.1), et j&#39;ai passé quelques heures à modifier notre code pour qu&#39;il passe les nouvelles règles.</p>

<p>Sur le projet, nous avons désactivé 27 règles parmi les centaines présentes. Par exemple, nous désactivons la limite sur le calcul de <a href="http://fr.wikipedia.org/wiki/Nombre_cyclomatique">complexité cyclomatique</a> puisque nous utilisons flog.</p>

<p>Rubocop nous a aussi aidé sur la complexité : une nouvelle règle a fait remonté quelques variables non utilisés. Les supprimer à fait baisser les notes de flog.</p>

<p>Pour l&#39;automatisation, un git-hooks lance un script shell :</p>

<ul>
<li>vérifiant le résultat de rubocop, </li>
<li>vérifiant qu&#39;il ne reste pas de trace d&#39;un conflit dans les fichiers,</li>
<li>vérifiant que tous les fichiers yaml sont syntaxiement juste (<code>find . -name *.yml -exec yaml-lint {} \;</code> pour les analyser, avec la gem <a href="https://rubygems.org/gems/yaml-lint">yaml-lint</a>)</li>
</ul>

<h3>KISS, et après</h3>

<p>Le <a href="http://fr.wikipedia.org/wiki/Principe_KISS">principe KISS</a> (pour Keep it simple and stupid) est une façon de travailler qui incite à rester simple pour être efficace.
Certains points cités plus hauts ne sont pas triviaux à mettre en place, mais permettent sur le long terme à limiter les risques, à garder facilement du code propre, compréhensible, et simple.</p>

<p>Ma todolist pour la suite ? </p>

<ul>
<li>Traquer le code dupliqué (j&#39;en ai déjà repéré quelques morceaux, dont le nettoyage n&#39;était pas possible dans le temps que j&#39;avais), </li>
<li>Supprimer le code mort et non utilisé.</li>
<li>Continuer à documenter, ranger, classer.</li>
<li>Refactoriser ce qui peut l&#39;être et dont le code n&#39;est pas amené à disparaître dans les prochains mois.</li>
</ul>
</div>
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page2">Older</a>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div>

    </div>

  <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
  <script type="text/javascript" src="/public/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/public/js/script.js"></script>
  </body>
</html>
