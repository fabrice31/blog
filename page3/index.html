<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr-fr" itemscope="" itemtype="http://schema.org/Blog">
  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; frame-src 'self' https://apis.google.com https://accounts.google.com; script-src 'self' http://code.jquery.com http://www.google-analytics.com https://apis.google.com; img-src 'self' http://www.google-analytics.com">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="description" content="Blog sur la qualité web en général, et l'automatisation de test web en particulier. Responsable tests et qualité web depuis 7 ans." />
  <meta name="keywords" content="test, watir, qualité, cucumber, jenkins, bug, selenium, appium, bournisien" />
  <meta name="robots" content="index,follow" />


  
    <title>Je teste donc je suis - Journal d'un testeur</title>
    <meta property="og:title" content="Je teste donc je suis" />
    <meta property="og:url" content="https://blog.fabricebournisien.eu/" />
    <meta property="og:type" content="website" />
  


  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">

  <!-- Icons -->
  <link rel="shortcut icon" type="image/png" href="/public/qualite-min.jpg">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <link rel="stylesheet" href="/public/fancybox/jquery.fancybox.css" type="text/css" media="screen" />

  <meta property="og:image"  content="/public/pictures/web-qualite.jpg"/>
  <meta itemprop="image"     content="/public/pictures/web-qualite.jpg" />
  <meta name="twitter:image" content="/public/pictures/web-qualite.jpg" />  
</head>

  <body class="theme-base-0c layout-reverse">
    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Je teste donc je suis
        </a>
      </h1>
      <p class="lead">Blog d'un automatiseur de tests web.</p>
    </div>

    <nav class="sidebar-nav">
      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/archive/">Archives</a>
          
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
	  <a class="sidebar-nav-item" href="http://www.fabricebournisien.eu">CV</a>
	  <!-- SiteSearch Google --> 
	  <form method="get" action="http://www.google.com/search"> 
		<input type="hidden" name="ie" value="UTF-8" /> 
		<input type="hidden" name="oe" value="UTF-8" /> 
		<input type="hidden" name="domains" value="blog.fabricebournisien.eu" /> 
		<input type="hidden" name="sitesearch" value="blog.fabricebournisien.eu" checked="checked" />
		<input type="text" name="q" size="18" maxlength="255" value="" title="Chercher sur le blog" />
		<input type="submit" name="btnG" value="Chercher" /> 
	  </form>
	  <!-- SiteSearch Google -->
    </nav>

    <p>&copy; 2019 - <a href="https://plus.google.com/104493142924184161356" rel="author">Fabrice Bournisien</a></p>
  </div>
</div>

    <div class="content container">
      <div class="posts">
  
  <div class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
    <h2 class="post-title" itemprop="name">
      <a href="/2013/10/17/bug-de-l-espace-temps/" itemprop="url" rel="bookmark">
        Bug de l'espace temps
      </a>
    </h2>

	<span class="post-date">
		<time class="date" datetime="2013-10-17" itemprop="datePublished">
			
			17
			octobre
			  
			2013
		</time>
		- par Fabrice Bournisien
		
		- <a href="/tag/bug">Bug</a>
		
	</span>

	<div itemprop="ArticleBody"><p>Dans notre outil, nous utilisons le langage twig. Cela permet une grande flexibilité, et d&#39;avoir un moteur déjà bien robuste.</p>

<p>Prenons par exemple l&#39;affichage d&#39;une date avec ce code :</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Post</span><span class="o">.</span><span class="no">Date</span><span class="o">|</span><span class="n">datel</span><span class="p">(</span><span class="no">Lang</span><span class="o">.</span><span class="no">Get</span><span class="p">(</span><span class="s2">"Default date format"</span><span class="p">))</span></code></pre></div>

<p>Notre outil étant multi langue, et les formats de date changeant avec la langue, nous utilisons une locale. En pratique, il s&#39;agit d&#39;une chaîne de caractères indiquant le format.</p>

<p>On pourrait avoir HH:mm pour l&#39;heure par exemple.</p>

<p>Dans l&#39;analyse du bug du jour, nous avons un signalement de date fausse sur certaines pages. Après vérifications nous trouvons une page datant du 3 janvier 2010, mais qui est affichée comme étant le 3 janvier 2009.</p>

<p>L&#39;enquête se poursuit en vérifiant les dates des autres pages : la quasi totalité des pages affichent une date juste. On finit par regrouper les pages à problèmes suivant le critères : certaines pages de début janvier de certaines années (mais pas toutes).</p>

<p>Le collègue qui cherchait a trouvé le problème.</p>

<div class="highlight"><pre><code class="language-cucumber" data-lang="cucumber"><span class="err">Default</span> <span class="err">date</span> <span class="err">format</span> <span class="err">=</span> <span class="err">MMMM</span> <span class="err">d</span> <span class="err">Y</span></code></pre></div>

<p>Dans la documentation de datel, Y = year of &quot;Week of Year&quot;. Il s&#39;agit de l&#39;année durant laquelle le week end du jour en question a eu lieu.</p>

<p>Il s&#39;agit donc d&#39;un bug visible pour les premiers jours de janvier pour lesquels la semaine commençait l&#39;année d&#39;avant. Tordu non ?</p>

<p>Pour la petite histoire, le code corrigé sans bug donne :</p>

<div class="highlight"><pre><code class="language-cucumber" data-lang="cucumber"><span class="err">Default</span> <span class="err">date</span> <span class="err">format</span> <span class="err">=</span> <span class="err">MMMM</span> <span class="err">d</span> <span class="err">yyyy</span></code></pre></div>
</div>
  </div>
  
  <div class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
    <h2 class="post-title" itemprop="name">
      <a href="/2013/06/17/affichage-des-resultats-de-tests/" itemprop="url" rel="bookmark">
        Affichage des résultats de tests
      </a>
    </h2>

	<span class="post-date">
		<time class="date" datetime="2013-06-17" itemprop="datePublished">
			
			17
			juin
			  
			2013
		</time>
		- par Fabrice Bournisien
		
		- <a href="/tag/test">Test</a>
		
		- <a href="/tag/jenkins">Jenkins</a>
		
	</span>

	<div itemprop="ArticleBody"><p>Lorsqu&#39;on teste avec jenkins, cucumber et watir, on obtient des rapports détaillés, qu&#39;il faut lire et analyser en permanence.</p>

<p>Depuis plusieurs mois, nous avons dans nos locaux une télé dédiée à l&#39;affichage de l&#39;état général de l&#39;ensemble de nos tests. Pour cela, le plugin Jenkins Wall Display nous a suffit dans un premier temps. Nous affichons sur la télé une page web qui fait défiler</p>

<p>Au total, sur ces écrans, nous affichons le résumé :</p>

<ul>
<li>Plus de 1 300 test php unit (et leur 5 000 assertions)</li>
<li>Près de 500 tests unitaires JS</li>
<li>Plus de 950 scénarios cucumber pour les tests fonctionnels.</li>
</ul>

<p>En outre, nous affichons aussi quelques graphiques sensibles de l&#39;état de la production : nombre de compte crées, etc..
On a beau regrouper toutes ces informations, il arrive un moment où l&#39;affichage n&#39;est plus lisible.</p>

<p><img src="/public/pictures/2013/screen-avant.jpg" alt="Exemple avec les tests fonctionnels" title="Affichage avant les travaux"></p>

<p>Le constat est moins alarmant pour les tests unitaires. Les chiffres exposent bien pourquoi :</p>

<ul>
<li>Tests fonctionnels : 40 jobs jenkins * 3 navigateurs</li>
<li>Tests unitaires : 18 jobs jenkins * 2 environnement</li>
</ul>

<h3>Comment afficher proprement les résultats</h3>

<p>Je suis parti en quête d&#39;une solution pour afficher tous nos résultats proprement, avec quelques contraintes :</p>

<ul>
<li>Je préférais afficher tous les résultats sur un seul écran par type de tests</li>
<li>Je veux pouvoir afficher un résumé ( x tests KO / x tests total)</li>
<li>Je veux pouvoir séparer facilement les affichages d&#39;un même type de tests (par navigateur / environnement)</li>
</ul>

<p>Ma quête fut longue et semée d&#39;embûches :</p>

<ul>
<li>Tentative d&#39;utilisation de l&#39;API, mais c&#39;était déjà trop lent alors que je ne calculais / affichais pas la moitié de ce que je voulais (45 secondes environ)</li>
<li>Plusieurs plugin jenkins, mais aucun ne permettant ce que je veux</li>
<li>Un Plugin jenkins faisant la moitié de ce que je voulais, mais complètement bugué</li>
</ul>

<h3>Mon premier plugin jenkins</h3>

<p>Je suis donc parti à l&#39;assaut de la documentation de jenkins pour coder un plugin fait-maison qui ferait exactement ce que je voudrais.</p>

<p>Ce que j&#39;ai bien aimé dans cette création :</p>

<ul>
<li>Tout en java. Je n&#39;avais pas codé en java depuis 10 ans je pense, et j&#39;ai perdu, mais vite repris mes repères.</li>
<li>Bosser sur un plugin que je pourrais diffuser en open-source à la fin :)</li>
<li>La possibilité de faire exactement ce que je veux, sans être limité par un plugin déjà fait.</li>
</ul>

<p>Ce que je n&#39;ai pas aimé :</p>

<ul>
<li>La documentation : elle existe, elle semble complète. Mais je trouve l&#39;organisation moyennement bonne. J&#39;ai plusieurs fois été à la recherche d&#39;exemple de code pour trouver la fonction dont j&#39;avais besoin, que je ne trouvais pas dans la doc.</li>
<li>L&#39;installation de maven qui marche du premier coup sur un de mes postes, mais se passe mal sur l&#39;autre.</li>
</ul>

<h3>Au final, ça donne quoi ?</h3>

<p>J&#39;ai donc un plugin qui permet de créer une nouvelle &quot;View&quot;. On peut y configurer :</p>

<ul>
<li>Les noms des colonnes, et la façon de filtrer les jobs dans chaque colonne, par des expression régulières.</li>
<li>Affichage dans chaque colonne du temps pris pour ces tests, du nombre de scénarios en échec et du nombre total de scénarios. (Afficher le nombre de jobs est beaucoup plus simple, mais donne beaucoup moins d&#39;informations : un job en échec pour 1 / 34 est moins grave qu&#39;un test avec 4 / 4 erreurs)</li>
<li>Affichage de la liste des jobs en échec (avec le nombre de scénarios)</li>
<li>Une colonne à part, qui affiche le temps total sur jenkins (master + slave)</li>
<li>Une liste de jobs spéciaux (dans mon cas : ceux qui lancent les autres, la génération de la doc...)</li>
</ul>

<p>Le plugin est sur github : <a href="https://github.com/fabrice31/CucumberJenkins">https://github.com/fabrice31/CucumberJenkins</a></p>

<p>Et maintenant ?</p>

<p>J&#39;ai configuré le plugin pour fonctionner avec cucumber, puisque je suis au coeur des tests fonctionnels. Il faut maintenant que je me débrouille pour que cet affichage fonctionne aussi bien avec tests php unit (séparés par des regexp par environnement cette fois)</p>

<p><img src="/public/pictures/2013/screen-apres.jpg" alt="Affichage de résultats cucumber" title="Affichage apres les travaux">
<img src="/public/pictures/2013/screen-config.jpg" alt="Plugin jenkins affichage de résultats cucumber" title="Configuration du plugin"></p>
</div>
  </div>
  
  <div class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
    <h2 class="post-title" itemprop="name">
      <a href="/2013/06/10/ruby-oauth-v1.0a-pour-optimiser-les-tests/" itemprop="url" rel="bookmark">
        Ruby - OAuth v1.0a pour optimiser les tests
      </a>
    </h2>

	<span class="post-date">
		<time class="date" datetime="2013-06-10" itemprop="datePublished">
			
			10
			juin
			  
			2013
		</time>
		- par Fabrice Bournisien
		
		- <a href="/tag/ruby">Ruby</a>
		
		- <a href="/tag/test">Test</a>
		
		- <a href="/tag/api">Api</a>
		
		- <a href="/tag/watir">Watir</a>
		
	</span>

	<div itemprop="ArticleBody"><p>Lors de tests, il arrive souvent qu&#39;on ait besoin de &quot;faire le ménage&quot; pour retrouver un état comme à l&#39;origine.
Plusieurs stratégies possibles, en fonction des technologies qu&#39;on souhaite utiliser.</p>

<h3>Un par un, à la fin</h3>

<p>Après chaque scénario, supprimer ce qui a été ajouté, annuler les modifications une par une.</p>

<p>Avantages : </p>

<ul>
<li>Facile à mettre en place (on réutilise ce qui a déjà été fait)</li>
</ul>

<p>Défauts : </p>

<ul>
<li>Si le scénario plante, on ne remet pas en l&#39;état</li>
<li>Chaque scénario prend un peu plus de temps (jusqu&#39;au double, dans le pire des cas)</li>
</ul>

<h3>Un par un, au début</h3>

<p>Avant chaque scénario, remettre les valeurs par défauts pour le test</p>

<p>Avantages :</p>

<ul>
<li>Facile à mettre en place (on réutilise ce qui a déjà été fait)</li>
</ul>

<p>Défauts :</p>

<ul>
<li>Si la remise à zéro ne marche pas, on ne teste pas</li>
<li>Chaque scénario prend un peu plus de temps (jusqu&#39;au double, dans le pire des cas)</li>
</ul>

<h3>Tous d&#39;un coup, dans une routine à part</h3>

<p>Puisqu&#39;on utilise un outil comme jenkins pour organiser tous les tests, on peut ajouter une routine &quot;à part&quot;, qui va se connecter sur chaque compte pour effectuer cette remise à zéro.</p>

<p>Avantages :</p>

<ul>
<li>Toutes les procédures de remises à zéro sont au même endroit</li>
</ul>

<p>Défauts :</p>

<ul>
<li>Un peu plus long à mettre en place</li>
<li>Demande d&#39;ajouter une sécurité pour ne pas la lancer au mauvais moment</li>
<li>Ca prend du temps (mais autant que de le faire un par un)</li>
</ul>

<h3>Optimisation : utilisation d&#39;une API</h3>

<p>Dans mon cas, nous disposons aussi d&#39;une API publique (en alpha, elle n&#39;est pas encore ouverte à tout le monde)</p>

<p>Avantages :</p>

<ul>
<li>Pas d&#39;interface web, cela devrait aller plus vite</li>
<li>Ajoutera &quot;en passant&quot; des tests sur la public API</li>
</ul>

<p>Défauts :</p>

<ul>
<li>Je ne maitrise pas du tout Oauth 1.0a (ça me permettra d&#39;apprendre : tant mieux)</li>
<li>Nous disposons d&#39;un SDK pour faciliter l&#39;utilisation de l&#39;API, en php. Pour des raisons pratiques, je préfère le faire en ruby, le serveur de tests étant déjà configuré pour cela. Je pars donc &quot;de zéro&quot;</li>
</ul>

<h3>Utiliser une API OAuth 1.0a en Ruby</h3>

<p>On trouve un peu de documentation pour le faire, et quelques exemples. Quelques remarques sur ces articles :
* La quasi totalité expose le même code d&#39;exemple.
* Rares sont ceux qui signalent la version d&#39;OAuth
* Les exemples se concentrent beaucoup sur &quot;comment se connecter à l&#39;api&quot;, et très rarement sur &quot;comment l&#39;utiliser&quot;</p>

<p>Voilà quelques astuces pour utiliser &quot;rapidement&quot; une API OAuth en ruby</p>

<h4>Utilisation de gems</h4>

<p>Elles facilitent la vie, autant en profiter.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">'oauth'</span>
<span class="nb">require</span> <span class="s1">'watir-webdriver'</span>
<span class="nb">require</span> <span class="s1">'json'</span></code></pre></div>

<h4>Définition de constantes de l&#39;api</h4>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">OB_API_SERVER</span>                 <span class="o">=</span> <span class="s1">'http://url_server_api'</span>
<span class="no">OB_API_BASE_URL</span>               <span class="o">=</span> <span class="no">OB_API_SERVER</span><span class="o">+</span><span class="s1">'/public/0.1'</span>
<span class="no">OB_API_ENDPOINT_REQUEST_TOKEN</span> <span class="o">=</span> <span class="s1">'/oauth/request_token'</span>
<span class="no">OB_API_ENDPOINT_ACCESS_TOKEN</span>  <span class="o">=</span> <span class="s1">'/oauth/access_token'</span>
<span class="no">OB_API_ENDPOINT_AUTHORIZE</span>     <span class="o">=</span> <span class="s1">'/oauth/authorize'</span>
<span class="no">OB_API_MY_CONSUMER_KEY</span>        <span class="o">=</span> <span class="s1">'######'</span>
<span class="no">OB_API_MY_CONSUMER_SECRET</span>     <span class="o">=</span> <span class="s1">'######'</span></code></pre></div>

<p>Obtenir la connexion à l&#39;API</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># create the OAuth consumer</span>
<span class="vi">@consumer</span> <span class="o">=</span> <span class="no">OAuth</span><span class="o">::</span><span class="no">Consumer</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span> 
    <span class="no">OB_API_MY_CONSUMER_KEY</span><span class="p">,</span>
    <span class="no">OB_API_MY_CONSUMER_SECRET</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="ss">:oauth_version</span>      <span class="o">=&gt;</span> <span class="s1">'1.0a'</span><span class="p">,</span>
        <span class="ss">:site</span>               <span class="o">=&gt;</span> <span class="no">OB_API_SERVER</span><span class="p">,</span>
        <span class="ss">:request_token_path</span> <span class="o">=&gt;</span> <span class="no">OB_API_ENDPOINT_REQUEST_TOKEN</span><span class="p">,</span>
        <span class="ss">:access_token_path</span>  <span class="o">=&gt;</span> <span class="no">OB_API_ENDPOINT_ACCESS_TOKEN</span><span class="p">,</span>
        <span class="ss">:authorize_path</span>     <span class="o">=&gt;</span> <span class="no">OB_API_ENDPOINT_AUTHORIZE</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="c1"># show all debugs in console</span>
<span class="c1"># @consumer.http.set_debug_output($stdout)</span>
<span class="c1"># get the authorize url</span>
<span class="vi">@request_token</span> <span class="o">=</span> <span class="vi">@consumer</span><span class="p">.</span><span class="nf">get_request_token</span>
<span class="c1"># Make as if the user authorize the app</span>
<span class="c1"># If you make a web app, you should show the link to your user, and let it click it</span>
<span class="c1"># browse the authorize url</span>
<span class="vi">@browser</span> <span class="o">=</span> <span class="no">Watir</span><span class="o">::</span><span class="no">Browser</span><span class="p">.</span><span class="nf">new</span>
<span class="vi">@browser</span><span class="p">.</span><span class="nf">goto</span><span class="p">(</span><span class="vi">@request_token</span><span class="p">.</span><span class="nf">authorize_url</span><span class="p">())</span>
<span class="c1"># connect with account</span>
<span class="vi">@browser</span><span class="p">.</span><span class="nf">text_field</span><span class="p">(</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">'email'</span><span class="p">).</span><span class="nf">set</span><span class="p">(</span><span class="s2">"test@test.fr"</span><span class="p">)</span>
<span class="vi">@browser</span><span class="p">.</span><span class="nf">text_field</span><span class="p">(</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">'passwd'</span><span class="p">).</span><span class="nf">set</span><span class="p">(</span><span class="s2">"monmotdepasse"</span><span class="p">)</span>
<span class="vi">@browser</span><span class="p">.</span><span class="nf">button</span><span class="p">(</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">'loginSubmit'</span><span class="p">).</span><span class="nf">click</span>
<span class="c1"># give access</span>
<span class="vi">@browser</span><span class="p">.</span><span class="nf">form</span><span class="p">.</span><span class="nf">submit</span>
<span class="c1"># get verifier token</span>
<span class="c1"># browser url contain oauth_verifier_token</span>
<span class="n">oauth_verifier_token</span> <span class="o">=</span> <span class="vi">@browser</span><span class="p">.</span><span class="nf">url</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s2">"oauth_verifier="</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># grant total access</span>
<span class="vi">@access_token</span> <span class="o">=</span> <span class="vi">@request_token</span><span class="p">.</span><span class="nf">get_access_token</span><span class="p">(</span><span class="ss">:oauth_verifier</span> <span class="o">=&gt;</span> <span class="n">oauth_verifier_token</span><span class="p">)</span>
<span class="c1"># no more browser needed</span>
<span class="vi">@browser</span><span class="p">.</span><span class="nf">close</span></code></pre></div>

<h4>Exemples d&#39;utilisation de l&#39;API OAuth</h4>

<p>Une fois qu&#39;on est connecté à l&#39;API, on peut l&#39;utiliser. Il faut lire sa documentation, en général assez touffue, pour savoir ce qu&#39;on peut faire (lister / ajouter / modifier / supprimer).
Voici deux exemples &quot;simplifiés&quot; pour mon exemple.</p>

<h5>Classique</h5>

<p>Afficher les informations sur le blog courant.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">get_url_info</span> <span class="o">=</span>  <span class="no">OB_API_BASE_URL</span><span class="o">+</span><span class="s1">'/blog/info'</span>
<span class="n">current_blog_info</span> <span class="o">=</span> <span class="vi">@access_token</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">get_url_info</span><span class="p">)</span></code></pre></div>

<h5>Avec une option</h5>

<p>Afficher la liste des titres des articles en brouillons.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">get_lists_content</span> <span class="o">=</span> <span class="no">OB_API_BASE_URL</span><span class="o">+</span><span class="s1">'/blog/posts/draft?limit=20'</span>
<span class="n">content_list</span> <span class="o">=</span> <span class="vi">@access_token</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">get_lists_content</span><span class="p">)</span>
<span class="c1"># read json results</span>
<span class="n">result</span> <span class="o">=</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">content_list</span><span class="p">.</span><span class="nf">body</span><span class="p">)</span>
<span class="n">result</span><span class="p">[</span><span class="s1">'response'</span><span class="p">].</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span> <span class="n">content</span> <span class="o">|</span>
    <span class="nb">puts</span> <span class="n">content</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]</span>
<span class="k">end</span></code></pre></div>

<p>Conclusions</p>

<ul>
<li>Ma routine journalière prenait environ 55 minutes. La nouvelle routine, via l&#39;api, dure environ 90 secondes.</li>
<li>J&#39;ai depuis très envie de l&#39;étendre pour ajouter de nouvelles procédures de remises à zéro.</li>
<li>La documentation est primordiale (que ce soit celle de l&#39;API ou celle de OAuth)</li>
</ul>
</div>
  </div>
  
  <div class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
    <h2 class="post-title" itemprop="name">
      <a href="/2013/04/22/comment-organiser-les-tests-sur-le-long-terme/" itemprop="url" rel="bookmark">
        Comment organiser les tests sur le long terme
      </a>
    </h2>

	<span class="post-date">
		<time class="date" datetime="2013-04-22" itemprop="datePublished">
			
			22
			avril
			  
			2013
		</time>
		- par Fabrice Bournisien
		
		- <a href="/tag/test">Test</a>
		
		- <a href="/tag/jenkins">Jenkins</a>
		
	</span>

	<div itemprop="ArticleBody"><h3>Exécuter une partie des tests</h3>

<p>Les scénarios sont taggués pour être lancé par jenkins par la commande : <code>cucumber --tag @montag</code>
Cela permet de ne lancer qu&#39;une partie des tests. (voir &quot;<a href="http://web-quality.over-blog.com/tester-sur-plusieurs-navigateurs">Tester sur plusieurs navigateurs</a>&quot; pour les détails)</p>

<h3>Serveurs</h3>

<p>Côté serveur, nous avons 2 serveurs jenkins.
Le principal, une grosse machine debian quadri core, qui exécute jusqu&#39;à 3 jobs en même temps.</p>

<p>Ensuite, un serveur Windows, avec un jenkins &quot;slave&quot;.
L&#39;esclave reçoit ses ordres du maître, qui lui demande d’exécuter des jobs particuliers.
Il est sous Windows pour pouvoir les exécuter sur Internet Explorer.</p>

<p>Pour éviter les effets de bords entre les tests sur IE, pas de solution. On vide donc les cookies, le cache, etc à la fermeture d&#39;Internet Explorer.
On ne peut donc pas exécuter les tests pour IE en parallèle sur le même serveur : les sessions se mélangeraient.</p>

<h3>Quelques chiffres</h3>

<p>Les scenarios sont regroupés en feature, dont le temps d&#39;execution est de maximum 10 minutes. Dans Jenkins on a 38 &quot;jobs&quot; sur FF (+ 34 sur IE)</p>

<p><strong>Firefox</strong></p>

<p>Chaque jour : 323 scénarios / 2693 step =&gt; 3h</p>

<p><strong>IE</strong> (1 fois par semaine actuellement, 1 fois par jour bientôt)</p>

<p>Chaque jour : 302 scénarios / 2527 step =&gt; 4h 30</p>

<p>Cela représente 227 500 scénarios par an (pour 2 737 heures de tests).</p>

<p>Sans oublier les lancements à la demande de certains jobs.</p>

<h4>Comptes utilisateurs</h4>

<p>Du côté des scénarios, ils utilisent pour le moment 70 comptes utilisateurs différents (avec des options particulières, etc...)</p>

<p>Un changement prochain de notre offre me fait penser que les tests auront besoin de 100 comptes d&#39;ici 2 à 3 semaines.</p>

<p>Sans oublier de dupliquer tout ça pour nos 2 environnements (test / stable)</p>

<p>Ni d&#39;ajouter l&#39;exécution de ces tests sur chrome.</p>

<p>Et on ajoute des tests fonctionnels en dehors de ce schéma, pour tester des choses particulière, que ce soit en production sur des points essentiels ou la validité de données particulières.</p>

<p>Et vous, combien vous testez ?</p>
</div>
  </div>
  
  <div class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
    <h2 class="post-title" itemprop="name">
      <a href="/2013/04/13/des-tests-automatiques-avec-contenus-aleatoires/" itemprop="url" rel="bookmark">
        Des tests automatiques avec contenus aléatoires
      </a>
    </h2>

	<span class="post-date">
		<time class="date" datetime="2013-04-13" itemprop="datePublished">
			
			13
			avril
			  
			2013
		</time>
		- par Fabrice Bournisien
		
		- <a href="/tag/cucumber">Cucumber</a>
		
		- <a href="/tag/watir">Watir</a>
		
		- <a href="/tag/test">Test</a>
		
	</span>

	<div itemprop="ArticleBody"><p>Si vous avez plusieurs tests qui s’exécutent en même temps sur le même environnement (le serveur de test), il faut veiller à bien tester la &quot;bonne chose&quot;.</p>

<p>Prenons un exemple de deux tests exécutés en même temps :</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="vi">@scenario1</span>
<span class="no">Scenario</span><span class="p">:</span> <span class="no">Test</span> <span class="n">modif</span> <span class="n">pseudo</span>
   <span class="no">Given</span> <span class="no">I</span> <span class="n">connect</span> <span class="n">to</span> <span class="n">my</span> <span class="s2">"pseudo"</span> <span class="n">account</span>
     <span class="no">When</span> <span class="no">I</span> <span class="n">change</span> <span class="n">my</span> <span class="n">nickname</span> <span class="k">for</span> <span class="s2">"pseudo-tmp"</span>
     <span class="no">When</span> <span class="no">I</span> <span class="n">publish</span> <span class="n">an</span> <span class="n">article</span> <span class="s2">"test pseudo-tmp"</span>
     <span class="no">Then</span> <span class="n">my</span> <span class="n">published</span> <span class="n">pseudo</span> <span class="n">is</span> <span class="s2">"pseudo-tmp"</span>
<span class="vi">@scenario2</span>
<span class="no">Scenario</span><span class="p">:</span> <span class="no">Pseudo</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">empty</span> <span class="k">when</span> <span class="n">you</span> <span class="n">publish</span>
   <span class="no">Given</span> <span class="no">I</span> <span class="n">connect</span> <span class="n">to</span> <span class="n">my</span> <span class="s2">"pseudo"</span> <span class="n">account</span>
     <span class="no">When</span> <span class="no">I</span> <span class="n">change</span> <span class="n">my</span> <span class="n">nickname</span> <span class="k">for</span> <span class="s2">""</span>
     <span class="no">When</span> <span class="no">I</span> <span class="n">publish</span> <span class="n">an</span> <span class="n">article</span> <span class="s2">"test pseudo"</span>
     <span class="no">Then</span> <span class="n">my</span> <span class="n">published</span> <span class="n">pseudo</span> <span class="n">is</span> <span class="s2">"pseudo"</span></code></pre></div>

<p>Si les 2 scénarios se terminent &quot;au même moment&quot;, nous aurons sur la page de contrôle 2 articles. L&#39;un signé avec &quot;pseudo-tmp&quot;, et l&#39;autre avec &quot;pseudo&quot;.</p>

<p>Si la vérification vérifie dans tout le contenu de la page des publications et pas seulement le dernier élément, cela pourrait bien se passer.</p>

<p>A un détail près :</p>

<ul>
<li>A 10h, le test s’exécute, il fonctionne.</li>
<li>A 15h, le test s’exécute mais les articles parus à 10h sont peut-être toujours affichés. On aura donc bien un article &quot;test pseudo&quot; sur la page alors qu&#39;un bug sera présent.</li>
</ul>

<p>Ma solution : <strong>ajouter de l&#39;aléatoire dans les tests</strong>.
Avant chaque scénario, je crée un token, composé de :
* 2 lettres du navigateur (ff, ie, ch..)
* un nombre aléatoire.
Et je l&#39;affiche en console (bien pratique pour débugguer)</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Before</span> <span class="k">do</span>
  <span class="vg">$token</span> <span class="o">=</span> <span class="no">Token</span><span class="p">.</span><span class="nf">new</span>
  <span class="nb">puts</span> <span class="s2">"Token for this test : </span><span class="si">#{</span><span class="vg">$token</span><span class="p">.</span><span class="nf">value</span><span class="si">}</span><span class="s2">"</span>
  <span class="sr">/* je vous fais grace du code pour lancer le navigateur, ... */</span> 
<span class="no">End</span></code></pre></div>

<p>Ma classe Token :</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Use to got random value</span>
<span class="c1"># Useful to post a data with random string but keep the value to check it later</span>
<span class="c1"># Author:: Fabrice</span>
<span class="k">class</span> <span class="nc">Token</span>
  <span class="c1"># Create a new token</span>
  <span class="c1"># Author:: Fabrice</span>
  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="vi">@value</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="no">ENV</span><span class="p">[</span><span class="s1">'BROWSER'</span><span class="p">]</span><span class="si">}#{</span><span class="mi">256</span><span class="o">*</span><span class="mi">256</span><span class="o">+</span><span class="nb">rand</span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
  <span class="c1"># Get the value of the last token</span>
  <span class="c1"># Author:: Fabrice</span>
  <span class="k">def</span> <span class="nf">value</span>
    <span class="vi">@value</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Ensuite, sans modifier le scénario, on modifie le code des étapes. Lorsqu&#39;on sauve une donnée, on ajoute le token &quot;courant&quot; dans le champ.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">title</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="n">title</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="vg">$token</span><span class="p">.</span><span class="nf">value</span><span class="si">}</span><span class="s2">"</span></code></pre></div>

<p>Et côté vérification, on en tient compte également.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">open_article</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">token</span> <span class="o">=</span> <span class="kp">false</span><span class="p">)</span>
  <span class="k">if</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
    <span class="vi">@browser</span><span class="p">.</span><span class="nf">link</span><span class="p">(</span><span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s2">"</span><span class="si">#{</span><span class="n">title</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="vg">$token</span><span class="p">.</span><span class="nf">value</span><span class="si">}</span><span class="s2">"</span><span class="p">).</span><span class="nf">click</span>
  <span class="k">else</span>
    <span class="vi">@browser</span><span class="p">.</span><span class="nf">link</span><span class="p">(</span><span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s2">"</span><span class="si">#{</span><span class="n">title</span><span class="si">}</span><span class="s2">"</span><span class="p">).</span><span class="nf">click</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Parfois, on a besoin de pouvoir jouer &quot;sans token&quot; pour des points bien précis : on prévoit alors un paramètre pour s&#39;en passer. (Exemple, pour la saisie d&#39;un email)</p>

<p>Ce genre de solution peut aussi vous éviter des effets de bords si vous publiez sur le même compte des articles avec le même titre. (Ceci, c&#39;est un autre test à part entière)</p>
</div>
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page4">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page2">Newer</a>
    
  
</div>

    </div>

  <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
  <script type="text/javascript" src="/public/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/public/js/script.js"></script>
  </body>
</html>
