<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr-fr" itemscope="" itemtype="http://schema.org/Blog">
  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; font-src 'self' http://fonts.googleapis.com/ http://fonts.gstatic.com; style-src 'self' 'unsafe-inline' http://fonts.googleapis.com; frame-src 'self' https://apis.google.com https://accounts.google.com; script-src 'self' http://code.jquery.com http://www.google-analytics.com https://apis.google.com; img-src 'self' http://www.google-analytics.com">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="description" content="Blog sur la qualité web en général, et l'automatisation de test web en particulier. Responsable tests et qualité web depuis 7 ans." />
  <meta name="keywords" content="test, watir, qualité, cucumber, jenkins, bug, selenium, appium, bournisien" />
  <meta name="robots" content="index,follow" />


  
    <title>KISS : Keep it simple and stupid &middot; Je teste donc je suis</title>
    <meta property="og:title" content="KISS : Keep it simple and stupid" />
    <meta property="og:url" content="/2014/12/13/kiss-simple-et-efficace/" />
    <meta property="og:type" content="article" />
  


  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700">

  <!-- Icons --
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">-->
  <link rel="shortcut icon" type="image/png" href="/public/qualite-min.jpg">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <link rel="stylesheet" href="/public/fancybox/jquery.fancybox.css" type="text/css" media="screen" />

  <meta property="og:image"  content="/public/pictures/web-qualite.jpg"/>
  <meta itemprop="image"     content="/public/pictures/web-qualite.jpg" />
  <meta name="twitter:image" content="/public/pictures/web-qualite.jpg" />  
</head>

  <body class="theme-base-0c layout-reverse">
    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Je teste donc je suis
        </a>
      </h1>
      <p class="lead">Blog d'un automatiseur de tests web.</p>
    </div>

    <nav class="sidebar-nav">
      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/archive/">Archives</a>
          
        
      
        
      
        
          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
	  <a class="sidebar-nav-item" href="http://www.fabricebournisien.eu">CV</a>
	  <!-- SiteSearch Google --> 
	  <form method="get" action="http://www.google.com/search"> 
		<input type="hidden" name="ie" value="UTF-8" /> 
		<input type="hidden" name="oe" value="UTF-8" /> 
		<input type="hidden" name="domains" value="blog.fabricebournisien.eu" /> 
		<input type="hidden" name="sitesearch" value="blog.fabricebournisien.eu" checked="checked" />
		<input type="text" name="q" size="18" maxlength="255" value="" title="Chercher sur le blog" />
		<input type="submit" name="btnG" value="Chercher" /> 
	  </form>
	  <!-- SiteSearch Google -->
    </nav>

    <p>&copy; 2015 - <a href="https://plus.google.com/104493142924184161356" rel="author">Fabrice Bournisien</a></p>
  </div>
</div>

    <div class="content container">
      <div class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
  <h2 class="post-title" itemprop="name">KISS : Keep it simple and stupid</h2>
  <span class="post-date">
	  <time class="date" datetime="2014-12-13" itemprop="datePublished">
		
		13
		décembre
		
		2014
	  </time>
	  - par Fabrice Bournisien
		
		- <a href="/tag/qualite">Qualite</a>
		
		- <a href="/tag/ruby">Ruby</a>
		
  </span>

	<div itemprop="ArticleBody"><p>Quand on travaille sur des gros projets, on a tendance à rajouter beaucoup de fonctions, de code, partout, à tout bout de champ.
Il faut savoir prendre du recul, pour simplifier le code, et faire des choses simples et efficaces.</p>

<p>Dans le cadre de mon travail, l&#39;équipe test a pas mal changé cet été, avec 2 nouveaux arrivants. Ca tombe bien, on a aussi récupéré des nouveaux projets à tester.
C&#39;est en les formant à nos méthodes, notre code, que j&#39;ai repéré des améliorations à faire, et qu&#39;ils ont fait des suggestions intéressantes.</p>

<p>Avec leur arrivée, une partie de ma charge de travail a pu diminuer un peu, me permettant de réflechir, de me poser des questions, de chercher des idées &quot;innovantes&quot; pour résoudre des problèmes mis de côté par manque de temps depuis des semaines (voire plus).</p>

<h3>Mise en place en 3 clics</h3>

<p>Bon, j&#39;éxagère, il faut plus que 3 clics. L&#39;utilisation d&#39;un Gemfile et de la gem <a href="https://rubygems.org/gems/bundler">bundler</a> permet de simplifier l&#39;ensemble de la procédure.</p>

<p>Pour préparer un nouveau poste (suite à une embauche, une réinstallation, ou un nouveau serveur, il faut alors installer ruby, la gem bundler, récupérer le dépôt du code, puis lancer juste la commande <code>bundle install</code>. 
Et le tour est joué.</p>

<p>Pour aller plus loin : mise en place sur tous les serveurs de tests d&#39;une routine vérifiant que la liste est à jour et conforme à ce qu&#39;on attend, avec un </p>
<div class="highlight"><pre><code class="language-" data-lang="">bundle update
gem cleanup
</code></pre></div>
<h3>L&#39;information, le nerf de la guerre</h3>

<p>Plongés dans les tests, nous disposions de plusieurs documentations, avec des buts plus ou moins précis. Localisées à plusieurs endroits.
Du coup, petit ménage d&#39;été, pour les regrouper, classer, mettre à jour. Au final, on a gardé plusieurs documents, pour plusieurs rôles différents :</p>

<ul>
<li><strong>Documentation du code</strong> : présente depuis le début, avec génération automatique par la gem ruby <a href="https://rubygems.org/gems/rdoc">rdoc</a> et un petit script ruby (basé sur des expressions régulières) pour lister les step_definitons. Basée évidemment sur les commentaires dans le code, qui sont eux mêmes le premier niveau d&#39;explication.</li>
<li><strong>Documentation sur comment coder</strong> : quelques documents précis sur comment installer l&#39;environnement, les conventions de codage, ou des points précis et complexe des tests.</li>
<li><strong>Documentation sur les produits</strong> : nous testons une demie douzaine de projets, plus ou moins liés les uns avec les autres. Pour pouvoir teter efficacement, il vaut mieux savoir comment le projet fonctionne, et dans l&#39;idéal, connaître également les bugs les plus courants sur le projet.</li>
</ul>

<h3>Codes complexes et compliqués</h3>

<p>Aujourd&#39;hui, l&#39;ensemble de nos codes testant les projets de la société représenter environ 11 000 lignes de codes (essentiellement en ruby, cucumber, shell)</p>

<p>Il y a 10 jours, j&#39;ai regardé pour la première fois depuis des mois les résultats de <a href="https://rubygems.org/gems/flog">flog</a> sur le projet. 
Pour résumer, flog analyse le code source, compte combien de fois on effectue chaque &quot;action&quot;, et s&#39;ensuit une note de complexité pour chaque méthode, et pour l&#39;ensemble.</p>

<p>Comme on peut classer, on voit immédiatement les fonctions les plus compliquées. Reste à savoir si la complexité est normale ou non. Après avoir lu pas mal d&#39;articles sur le sujet, et testé moi même sur notre code, j&#39;estime qu&#39;une fonction avec un score supérieur à 50 doit être analysée, et éventuellement, modifiée.</p>

<h4>Quelques chiffres</h4>

<p>J&#39;ai profité d&#39;un &quot;temps calme&quot; au bureau pour bosser sur le sujet. </p>

<p>Avant :</p>
<div class="highlight"><pre><code class="language-" data-lang="">  7128.5: flog total
    15.6: flog/method average

   793.5: main#none
   236.1: main#launch_browser
   197.0: main#get_job_results
   138.0: Then#/^HTML (contain|don't contain) (.*)$/
   136.7: Then#/^I don't see errors$/
   134.8: FormatPage#format_is_present
   131.1: main#compare_stats
    90.7: Then#/^I click on the insocial expand$/
    81.4: main#stats_of_day
</code></pre></div>
<p>Après : </p>
<div class="highlight"><pre><code class="language-" data-lang=""> 6166.2: flog total
    13.8: flog/method average

   827.4: main#none
   197.0: main#get_job_results
   168.0: main#launch_browser
   134.8: FormatPage#format_is_present
    90.7: Then#/^I click on the insocial expand$/
    90.3: main#compare_stats
    77.0: main#stats_of_day
</code></pre></div>
<p>On note plusieurs choses :</p>

<ul>
<li>La note globale a chuté (-14%). </li>
<li>Cela fait mathématiquement baissé la moyenne par méthode.</li>
<li>Certaines méthodes &quot;complexes&quot; ont bien baissé.</li>
<li>D&#39;autres ont augmenté : avec les pull request de mes collègues, rien d&#39;aberrant. La note a donc baissé alors que dans le même temps, plus de 1 500 lignes de code ont été ajoutées / modifiées.</li>
<li>Certaines méthodes, complexes, ont une note qui correspond à leur difficulté de compréhension. </li>
</ul>

<h4>Qu&#39;est ce que j&#39;ai changé ?</h4>

<p>Rien de transcendant :</p>

<ul>
<li>Du code dupliqué a été &quot;mis en commun&quot; pour faciliter la maintenance.</li>
<li>Des optimisations faciles : par exemple, dans une méthode utilisant beaucoup de données, j&#39;ai remplacé l&#39;utilisation d&#39;un tableau par une copie du contenu d&#39;une données. Passer de <code>my_array[&#39;result&#39;][&#39;report&#39;][&#39;url&#39;]</code> à <code>my_url</code> quand c&#39;est utilisé 7-8 fois, ça améliore la complexité et aussi la lisibilité et la maintenabilité.</li>
<li>Des méthodes ont été découpées pour clarifier ce que le code faisait.</li>
</ul>

<h3>Et c&#39;est conventionnel tout ça ?</h3>

<p>En parralèle, j&#39;ai mis à jour la gem <a href="https://rubygems.org/gems/rubocop">rubocop</a>. Cette gem permet de vérifier que toutes les conventions sont respectées. La liste des choses vérifiées s&#39;est beaucoup étoffée depuis la dernière fois que j&#39;avais mis à jour la gemme (de 0.18.1 à 0.27.1), et j&#39;ai passé quelques heures à modifier notre code pour qu&#39;il passe les nouvelles règles.</p>

<p>Sur le projet, nous avons désactivé 27 règles parmi les centaines présentes. Par exemple, nous désactivons la limite sur le calcul de <a href="http://fr.wikipedia.org/wiki/Nombre_cyclomatique">complexité cyclomatique</a> puisque nous utilisons flog.</p>

<p>Rubocop nous a aussi aidé sur la complexité : une nouvelle règle a fait remonté quelques variables non utilisés. Les supprimer à fait baisser les notes de flog.</p>

<p>Pour l&#39;automatisation, un git-hooks lance un script shell :</p>

<ul>
<li>vérifiant le résultat de rubocop, </li>
<li>vérifiant qu&#39;il ne reste pas de trace d&#39;un conflit dans les fichiers,</li>
<li>vérifiant que tous les fichiers yaml sont syntaxiement juste (<code>find . -name *.yml -exec yaml-lint {} \;</code> pour les analyser, avec la gem <a href="https://rubygems.org/gems/yaml-lint">yaml-lint</a>)</li>
</ul>

<h3>KISS, et après</h3>

<p>Le <a href="http://fr.wikipedia.org/wiki/Principe_KISS">principe KISS</a> (pour Keep it simple and stupid) est une façon de travailler qui incite à rester simple pour être efficace.
Certains points cités plus hauts ne sont pas triviaux à mettre en place, mais permettent sur le long terme à limiter les risques, à garder facilement du code propre, compréhensible, et simple.</p>

<p>Ma todolist pour la suite ? </p>

<ul>
<li>Traquer le code dupliqué (j&#39;en ai déjà repéré quelques morceaux, dont le nettoyage n&#39;était pas possible dans le temps que j&#39;avais), </li>
<li>Supprimer le code mort et non utilisé.</li>
<li>Continuer à documenter, ranger, classer.</li>
<li>Refactoriser ce qui peut l&#39;être et dont le code n&#39;est pas amené à disparaître dans les prochains mois.</li>
</ul>
</div>

	<!--div class="share">
		<div class="twitter-share">
			<iframe src="http://platform.twitter.com/widgets/tweet_button.html?url=http%3A%2F%2Fblog.fabricebournisien.eu%2F%2F2014%2F12%2F13%2Fkiss-simple-et-efficace%2F&amp;via=fabrice31&amp;text=KISS : Keep it simple and stupid&amp;lang=fr&amp;count=horizontal" frameborder="0" allowTransparency="1" scrolling="no" style="height:20px;width:133px;"></iframe>
		</div>
		<div class="facebook-share">
			<iframe src="//www.facebook.com/plugins/like.php?href=http://blog.fabricebournisien.eu//2014/12/13/kiss-simple-et-efficace/&amp;send=false&amp;layout=button_count&amp;show_faces=false&amp;action=like&amp;colorscheme=light&amp;font" frameborder="0" allowTransparency="1" scrolling="no" style="height:20px;width:133px;"></iframe>
		</div>
		<div class="google-share">
			<iframe src="https://plusone.google.com/u/0/_/+1/fastbutton?url=http://blog.fabricebournisien.eu//2014/12/13/kiss-simple-et-efficace/&amp;size=medium&amp;annotation=bubble&amp;lang=fr" frameborder="0" allowTransparency="1" scrolling="no" style="height:20px;width:90px;"></iframe>
		</div>
	</div-->

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
		  <a href="http://blog.fabricebournisien.eu//2015/09/28/empirique-service-tests/">
			L'empirique au service des tests
			<small>28 Sep 2015</small>
		  </a>
      </li>
    
      <li>
		  <a href="http://blog.fabricebournisien.eu//2015/01/15/kiss-simple-n-est-pas-toujours-simple/">
			La simplicité n'est pas toujours simple
			<small>15 Jan 2015</small>
		  </a>
      </li>
    
      <li>
		  <a href="http://blog.fabricebournisien.eu//2015/01/07/petits-plaisirs-de-la-vie/">
			Petits plaisirs de la vie
			<small>07 Jan 2015</small>
		  </a>
      </li>
    
  </ul>
</div>

<script src="https://apis.google.com/js/plusone.js"></script>
<div class="g-comments"
    data-href="http://blog.fabricebournisien.eu//2014/12/13/kiss-simple-et-efficace/"
    data-width="642"
    data-first_party_property="BLOGGER"
    data-view_type="FILTERED_POSTMOD">
</div>

    </div>

  <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
  <script type="text/javascript" src="/public/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/public/js/script.js"></script>
  </body>
</html>
