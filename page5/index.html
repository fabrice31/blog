<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr-fr" itemscope="" itemtype="http://schema.org/Blog">
  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="description" content="Blog sur la qualité web en général, et l'automatisation de test web en particulier. Responsable tests et qualité web depuis 7 ans." />
  <meta name="keywords" content="test, watir, qualité, cucumber, jenkins, bug, selenium, appium, bournisien" />
  <meta name="robots" content="index,follow" />

  <title>
    
      Je teste donc je suis &middot; Journal d'un testeur
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700">

  <!-- Icons --
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">-->
  <link rel="shortcut icon" type="image/png" href="/public/qualite.jpg">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <link rel="stylesheet" href="/public/fancybox/jquery.fancybox.css" type="text/css" media="screen" />

  <meta property="og:image"  content="/public/pictures/web-qualite.jpg"/>
  <meta itemprop="image"     content="/public/pictures/web-qualite.jpg" />
  <meta name="twitter:image" content="/public/pictures/web-qualite.jpg" />  
</head>

  <body class="theme-base-0c layout-reverse">
    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Je teste donc je suis
        </a>
      </h1>
      <p class="lead">Blog d'un automatiseur de tests web.</p>
    </div>

    <nav class="sidebar-nav">
      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/archive/">Archive</a>
          
        
      
        
      
        
          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
	  <a class="sidebar-nav-item" href="http://www.fabricebournisien.eu">CV</a>
	  <!-- SiteSearch Google --> 
	  <form method="get" action="http://www.google.com/search"> 
		<input type="hidden" name="ie" value="UTF-8" /> 
		<input type="hidden" name="oe" value="UTF-8" /> 
		<input type="hidden" name="domains" value="blog.fabricebournisien.eu" /> 
		<input type="hidden" name="sitesearch" value="blog.fabricebournisien.eu" checked="checked" />
		<input type="text" name="q" size="18" maxlength="255" value="" />
		<input type="submit" name="btnG" value="Chercher" /> 
	  </form>
	  <!-- SiteSearch Google -->
    </nav>

    <p>&copy; 2014 - <a href="https://plus.google.com/104493142924184161356" rel="author">Fabrice Bournisien</a></p>
  </div>
</div>

    <div class="content container">
      <div class="posts">
  
  <div class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
    <h2 class="post-title" itemprop="name">
      <a href="/2013/02/26/tester-sur-plusieurs-navigateurs/" itemprop="url" rel="bookmark">
        Tester sur plusieurs navigateurs
      </a>
    </h2>

	<span class="post-date">
		<time class="date" datetime="2013-02-26" itemprop="datePublished">
			26/02/2013
		</time>
		- par Fabrice Bournisien
		
		- <a href="/tag/cucumber">Cucumber</a>
		
		- <a href="/tag/watir">Watir</a>
		
	</span>

	<div itemprop="ArticleBody"><p>Tester de façon automatique, c&#39;est bien. Le faire sur plusieurs environnements, c&#39;est mieux.</p>

<p>Dans mon cas, par défaut, mes tests sont lancés sur Firefox. Sur un serveur jenkins-ci (sur debian), c&#39;est en effet le navigateur le plus facile à gérer. Ils sont exécutés une fois par jour, et aussi à la demande.</p>

<p>Certains scenarios testent la version mobile de nos sites. Il nous faut aussi tester nos sites pour différents navigateurs. Pour cela, les profils et les tags de cucumber sont très intéressants.</p>

<h3>Tags cucumber</h3>

<p>Au dessus de chaque scénario, il est possible de lister des tags. On peut ensuite exécuter tous les tests portant un tag particulier.</p>

<p>Cela permet de découper l&#39;exécution de nombreux scénarios en plusieurs jobs sur jenkins, ce qui est plus confortable : si un test passe dans le rouge, il faut analyser un rapport pour 10 scénario au lieu de 300. Si on veut re-tester ce point précis, on mettra également moins de temps.</p>

<p>On exécute les scénarios avec la ligne &quot;cucumber --tag @montag&quot;. Si le tag n&#39;existe pas, le résultat affichera immédiatement 0 scenarios.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="vi">@admin</span> <span class="vi">@montag</span> <span class="vi">@ie</span>
<span class="no">Scenario</span><span class="p">:</span> <span class="nb">test</span> <span class="n">un</span> <span class="n">tag</span>
  <span class="no">When</span> <span class="no">I</span> <span class="nb">test</span>
  <span class="no">Then</span> <span class="no">I</span> <span class="n">tested</span>
</code></pre></div>
<h3>Cucumber.yml</h3>

<p>Les profils de cucumber se gère dans un fichier au format yaml, qui peut gérer beaucoup de choses :</p>

<ul>
<li>Ajouter automatiquement des paramètres de tags</li>
<li>Passer des variables à l&#39;environnement de tests, qui peut ensuite les utiliser.</li>
</ul>

<p>Exemple avec une partie de mon fichier :</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&lt;</span><span class="sx">% common </span><span class="o">=</span> <span class="s2">"-r support -r features --tags ~@wip --tags ~@danger 
--color --format pretty --format html -o results.html --format junit -o junit"</span> <span class="o">%&gt;</span>
<span class="c1"># default : staging and firefox</span>
<span class="ss">default: </span><span class="o">&lt;</span><span class="sx">%= common %&gt; BROWSER=</span><span class="n">firefox</span>
<span class="ss">danger: </span><span class="o">-</span><span class="n">r</span> <span class="n">support</span> <span class="o">-</span><span class="n">r</span> <span class="n">features</span> <span class="o">--</span><span class="n">tags</span> <span class="o">~</span><span class="vi">@wip</span> <span class="o">--</span><span class="n">color</span> <span class="o">--</span><span class="nb">format</span> <span class="n">pretty</span> <span class="no">BROWSER</span><span class="o">=</span><span class="n">firefox</span>
<span class="ss">ie: </span><span class="o">&lt;</span><span class="sx">%= common %&gt; ENV=</span><span class="n">staging</span> <span class="no">BROWSER</span><span class="o">=</span><span class="n">ie</span>
<span class="ss">ff: </span><span class="o">&lt;</span><span class="sx">%= common %&gt; ENV=</span><span class="n">staging</span> <span class="no">BROWSER</span><span class="o">=</span><span class="n">firefox</span>
<span class="ss">chrome: </span><span class="o">&lt;</span><span class="sx">%= common %&gt; ENV=</span><span class="n">staging</span> <span class="no">BROWSER</span><span class="o">=</span><span class="n">chrome</span>
<span class="ss">mobile: </span><span class="o">&lt;</span><span class="sx">%= common %&gt; ENV=</span><span class="n">staging</span> <span class="no">BROWSER</span><span class="o">=</span><span class="n">mobile</span>
</code></pre></div>
<p>La première ligne définit des paramètres commun à la plupart des profils :</p>

<ul>
<li>On impose de récupérer le dossier features (dans lequel se trouvent les scenarios) et le dosser support (qui contient le code qui &quot;gère&quot; le navigateur)</li>
<li>On exclut les tests portant le tag @wip (work in progress) et le tag @danger</li>
<li>On demande l&#39;affichage des résultats complets (avec les étapes et la couleur)</li>
<li>On demande l&#39;export des résultats au format html et au format junit</li>
</ul>

<p>Lorsqu&#39;on utilise un profil, on peut lancer pour un tag donné. Exemple : <code>cucumber . --tag @test -p chrome</code></p>

<p>Viennent ensuite les profils :</p>

<ul>
<li>-p default: lance les tests sur firefox</li>
<li>-p danger: autorise le lancement des tests taggués @danger</li>
<li>-p ie, ff, chrome, mobile: lance les tests sur un navigateur particulier</li>
</ul>

<h3>Différences entre les navigateurs</h3>

<p>Passer le nom du navigateur ne suffit pas, il faut également l&#39;utiliser dans le code pour travailler avec le navigateur voulu.</p>

<p>Dans notre cas, nous lancons le navigaeur avant chaque scénario pour éviter qu&#39;un test ait un impact sur le suivant.</p>

<p>Voici le code :</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Before</span> <span class="k">do</span>
  <span class="k">case</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'BROWSER'</span><span class="p">]</span>
  <span class="k">when</span> <span class="s1">'ie'</span>
    <span class="vi">@browser</span> <span class="o">=</span> <span class="no">Watir</span><span class="o">::</span><span class="no">Browser</span><span class="p">.</span><span class="nf">new</span> <span class="ss">:ie</span>
  <span class="k">when</span> <span class="s1">'mobile'</span>
    <span class="n">mobile_useragent</span> <span class="o">=</span> <span class="s2">"Mozilla/5.0 (iPhone; CPU iPhone OS 5_1_1 like \
        Mac OS X) AppleWebKit/534.46 (KHTML, like Gecko) Version/5.1 \
        Mobile/9B206 Safari/7534.48.3"</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Firefox</span><span class="o">::</span><span class="no">Profile</span><span class="p">.</span><span class="nf">new</span>
    <span class="n">profile</span><span class="p">[</span><span class="s1">'general.useragent.override'</span><span class="p">]</span> <span class="o">=</span> <span class="n">mobile_useragent</span>
    <span class="vi">@browser</span> <span class="o">=</span> <span class="no">Watir</span><span class="o">::</span><span class="no">Browser</span><span class="p">.</span><span class="nf">new</span> <span class="ss">:firefox</span><span class="p">,</span> <span class="ss">:profile</span> <span class="o">=&gt;</span> <span class="n">profile</span>
  <span class="k">when</span> <span class="s1">'chrome'</span>
    <span class="vi">@browser</span> <span class="o">=</span> <span class="no">Watir</span><span class="o">::</span><span class="no">Browser</span><span class="p">.</span><span class="nf">new</span> <span class="ss">:chrome</span>
  <span class="k">else</span>
    <span class="c1"># Default case : firefox</span>
    <span class="n">download_directory</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="no">Dir</span><span class="p">.</span><span class="nf">pwd</span><span class="si">}</span><span class="s2">/downloads"</span>
    <span class="n">download_directory</span><span class="p">.</span><span class="nf">gsub!</span><span class="p">(</span><span class="s2">"/"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">"</span><span class="p">)</span> <span class="p">\</span>
        <span class="k">if</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Platform</span><span class="p">.</span><span class="nf">windows?</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Firefox</span><span class="o">::</span><span class="no">Profile</span><span class="p">.</span><span class="nf">new</span>
    <span class="n">profile</span><span class="p">[</span><span class="s1">'browser.download.folderList'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">profile</span><span class="p">[</span><span class="s1">'browser.download.dir'</span><span class="p">]</span> <span class="o">=</span> <span class="n">download_directory</span>
    <span class="n">profile</span><span class="p">[</span><span class="s1">'browser.link.open_newwindow'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">profile</span><span class="p">[</span><span class="s1">'browser.helperApps.neverAsk.saveToDisk'</span><span class="p">]</span> <span class="o">=</span> <span class="p">\</span>
        <span class="s2">"application/octet-stream"</span>
    <span class="n">profile</span><span class="p">[</span><span class="s1">'network.http.use-cache'</span><span class="p">]</span> <span class="o">=</span> <span class="kp">false</span>
    <span class="vi">@browser</span> <span class="o">=</span> <span class="no">Watir</span><span class="o">::</span><span class="no">Browser</span><span class="p">.</span><span class="nf">new</span> <span class="ss">:firefox</span><span class="p">,</span> <span class="ss">:profile</span> <span class="o">=&gt;</span> <span class="n">profile</span>
  <span class="k">end</span>
  <span class="c1"># Resize window</span>
  <span class="k">if</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'BROWSER'</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">'mobile'</span>
    <span class="vi">@browser</span><span class="p">.</span><span class="nf">window</span><span class="p">.</span><span class="nf">resize_to</span><span class="p">(</span><span class="mi">1100</span><span class="p">,</span> <span class="mi">900</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="vi">@browser</span><span class="p">.</span><span class="nf">window</span><span class="p">.</span><span class="nf">resize_to</span><span class="p">(</span><span class="mi">640</span><span class="p">,</span> <span class="mi">960</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>On exploite le nom du navigateur pour lancer le bon, avec des paramètres particuliers.</p>

<ul>
<li>Le mobile lance un Firefox avec le profil d&#39;un navigateur Iphone (et une résolution de classique pour un mobile)</li>
<li>Pour internet explorer et chrome, il faut avoir téléchargé les exécutables (sur le groupe selenium) et les avoir ajoutés au path</li>
<li>Pour firefox, on ajoute des paramètres pour effectuer des tests d&#39;upload et download de fichiers)</li>
</ul>

<h3>Les tests ont-ils changés ?</h3>

<p>Lorsque j&#39;ai commencé à coder ces tests, il y a plus d&#39;un an, j&#39;avais anticipé l&#39;architecture pour gérer ce genre de problématique. La mise en place n&#39;a pourtant pas eu lieu sans douleur.</p>

<p>Certains navigateurs ne se comportent pas tout à fait comme les autres. Il faut donc mettre à jour son code pour qu&#39;il soit le plus &quot;ré utilisable possible&quot;.</p>

<p>Dans le cas d&#39;Internet Explorer, les modifications apportées :</p>

<ul>
<li>Ajout d&#39;un tag @ie sur les tests compatibles (et stables) avec IE.</li>
<li>Dans certains cas de remplissage de formulaire, ajout d&#39;une ligne de code pour donner le focus au champ à remplir</li>
<li>Modification des timeout du projet.</li>
</ul>

<p>On lance donc les tests pour Internet Explorer avec la commande <code>cucumber --tag @ie -p ie</code>. On peut changer le tag, mais certains ne fonctionnent pas encore sous IE à cause de codes vraiment spécifiques.</p>

<p>Voici deux exemples de code modifé spécifiquement pour IE :</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">if</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'BROWSER'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'ie'</span>
  <span class="c1"># internet explorer is slower : timeout increase</span>
  <span class="no">SHORT_TIMEOUT</span> <span class="o">=</span> <span class="mi">5</span>
  <span class="no">TIMEOUT</span> <span class="o">=</span> <span class="mi">15</span>
  <span class="no">LONG_TIMEOUT</span> <span class="o">=</span> <span class="mi">25</span>
<span class="k">else</span>
  <span class="no">SHORT_TIMEOUT</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="no">TIMEOUT</span> <span class="o">=</span> <span class="mi">9</span>
  <span class="no">LONG_TIMEOUT</span> <span class="o">=</span> <span class="mi">25</span>
<span class="k">end</span>
</code></pre></div>
<p>Ce code définit les constantes des timeout pour l&#39;ensemble des test.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">if</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'BROWSER'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'ie'</span>
  <span class="nb">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># need for IE purpose</span>
<span class="k">end</span>
<span class="nb">self</span><span class="p">.</span><span class="nf">wait_until</span><span class="p">(</span><span class="no">LONG_TIMEOUT</span><span class="p">){</span>
  <span class="nb">self</span><span class="p">.</span><span class="nf">login_element</span><span class="p">.</span><span class="nf">exists?</span> <span class="n">and</span> <span class="nb">self</span><span class="p">.</span><span class="nf">login_element</span><span class="p">.</span><span class="nf">visible?</span>
<span class="p">}</span>
<span class="nb">self</span><span class="p">.</span><span class="nf">username_element</span><span class="p">.</span><span class="nf">focus</span> <span class="c1"># need for IE purpose</span>
<span class="nb">self</span><span class="p">.</span><span class="nf">username</span> <span class="o">=</span> <span class="vi">@account</span><span class="p">.</span><span class="nf">email</span>
</code></pre></div>
<p>Les commentaires dans le code parlent d&#39;eux mêmes. Documenter le code spécifique à IE est d&#39;ailleurs indispensable si on veut garder ses modifications qui semblent &quot;inutiles&quot;.</p>

<p>Si les tests avec Firefox sont joués chaque jour sur un serveur, en 2h45 environ, ceux pour IE sont exécutés en local, en 3h, alors que certains tests ne sont pas exécutés sur IE.</p>

<p>Ce sont donc plus de 300 scénarios par jour, 12 000 par mois. Sans compter les tests unitaires, les tests manuels...</p>
</div>
  </div>
  
  <div class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
    <h2 class="post-title" itemprop="name">
      <a href="/2013/01/22/il-faut-savoir-se-fier-a-ses-tests/" itemprop="url" rel="bookmark">
        Il faut savoir se fier à ses tests
      </a>
    </h2>

	<span class="post-date">
		<time class="date" datetime="2013-01-22" itemprop="datePublished">
			22/01/2013
		</time>
		- par Fabrice Bournisien
		
		- <a href="/tag/test">Test</a>
		
		- <a href="/tag/bug">Bug</a>
		
	</span>

	<div itemprop="ArticleBody"><p>Vroici l&#39;histoire d&#39;un test fonctionnel &quot;basique&quot; mais techniquement compliqué à mettre en place.</p>

<h3>Passé</h3>

<p>Depuis plusieurs mois, nous sommes 2 à developper les tests automatiques. Nous avons une longue liste de tests à ajouter que nous dépilons progressivement. Certains tests sont présents depuis longtemps dans cette liste, mais nous ne réussissons tout simplement pas à les créer, pour des raisons purement techniques. D&#39;autres sont en attente de la correction du bug sur le produit.</p>

<h3>Lundi</h3>

<p>Pour l&#39;un d&#39;eux, je réussi finalement à trouver une solution tarabiscotée qui semble marcher. La solution ne me plait pas totalement, cela revient à exécuter du javascript dans un navigateur que je controle avec watir, lancé depuis un cucumber géré par un jenkins.</p>

<p>L&#39;utilisation du javascript (langage que je ne maîtrise pas) pour ce détail me gêne : s&#39;il me permet de tester la fonctionnalité, je ne pourrais pas simplement tester certains points de la fonctionnalité.</p>

<p>En outre, cela m&#39;empêche d&#39;être sur de moi pour ce test : j&#39;ai peur qu&#39;il ne soit pas stable et pérenne.</p>

<h3>Mercredi</h3>

<p>Mercredi dernier, j&#39;ai remonté un problème qui entrainait un problème en cascade sur l&#39;ensemble de mes tests fonctionnels (40 scenarios échoués sur 270).</p>

<p>Il y avait deux importants chantiers effectués par mes collègues pour des mises à jours importantes, qui demandait des corrections.</p>

<p><img src="/public/pictures/2013/mug-qualite.jpg" alt="Il faut savoir se fier à ses tests"></p>

<h3>Jeudi</h3>

<p>Jeudi, c&#39;est normalement la fin du codage des nouveautés pour le sprint en cours. Le jeudi c&#39;est donc débug, tests, préparation du changelog et de la mise en production...</p>

<p>Lorsque j&#39;arrive un jeudi avec mes indicateurs qui clignotent en rouge, je n&#39;aime pas ça. Je survole rapidement, vois que c&#39;est un problème commun pour les 10 premiers rapports que j&#39;analyse en profondeur. Je demande donc une nouvelle correction, puis je relance des tests qui semblent être juste des faux positifs. Certains reviennent à la normale.</p>

<p>Je désactive certains tests qui paraissent toujours instables. Parmi eux, les tests ajoutés le lundi : je ne les sentais pas en les codant, je n&#39;ai pas cru en eux lorsqu&#39;ils ont signalé un bug.</p>

<h3>Lundi</h3>

<p>Lundi, jour de la mise en production. Une fois finie, l&#39;équipe teste en production les changements pour vérifier que tout est normal.</p>

<p>En faisant un test sur tout à fait autre chose, je me suis dit &quot;y&#39;a un truc qui cloche, (pas ce que je suis en train de tester), mais je vois pas quoi&quot;. Mon instinct me disait que j&#39;avais raté un truc. Je fais donc un tour du côté du support.</p>

<p>Les premiers retours utilisateurs signalent un bug m&#39;a fait sourciller : on signale un bug sur la fonction testée depuis peu. Je vérifie le dernier rapport de tests : ils détectaient le bug, et étaient parfaitement stables.</p>

<h3>Conclusion</h3>

<p>En n&#39;ayant pas cru en la stabilité d&#39;un test que j&#39;ai codé moi-même, j&#39;ai laissé passer un bug en production.</p>

<p>J&#39;ai vu un faux positif plutôt qu&#39;un bug réel, alors que j&#39;expliquais ce risque il y a longtemps.</p>

<p>J&#39;ai l&#39;impression d&#39;avoir échoué à garantir la qualité de notre produit. J&#39;ai eu trop confiance dans mes collègues, et pas assez en moi.</p>
</div>
  </div>
  
  <div class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
    <h2 class="post-title" itemprop="name">
      <a href="/2012/12/06/tester-un-site-multilingue/" itemprop="url" rel="bookmark">
        Tester un site multilingue
      </a>
    </h2>

	<span class="post-date">
		<time class="date" datetime="2012-12-06" itemprop="datePublished">
			06/12/2012
		</time>
		- par Fabrice Bournisien
		
		- <a href="/tag/test">Test</a>
		
		- <a href="/tag/watir">Watir</a>
		
	</span>

	<div itemprop="ArticleBody"><p>Travailler sur un site international demande de multiplier les tests.</p>

<p>D&#39;abord, si l&#39;interface change, il est parfois intéressant de la tester dans chaque langue. Dans mon cas, ce n&#39;est pas fait. Le principal risque des &quot;langues&quot; est l&#39;affichage des textes (du point de vue design), ce qui ne peut pas être testé de façon automatique. Pour cela, une équipe multilangue qui vérifie les modifications et leurs impacts est plus réaliste.</p>

<p>L&#39;autre aspect important, c&#39;est l&#39;accès au site en fonction de la langue. Si vous avez une stratégie de redirection en fonction de la langue, il faut pouvoir le tester. J&#39;ai l&#39;impression que cela m&#39;a pris du temps, alors qu&#39;au final, c&#39;est tout simple. Mais j&#39;ai exploré beaucoup de pistes sur le sujet.</p>

<h3>Le test</h3>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">TestProductionFrench</span> <span class="o">&lt;</span> <span class="no">Test</span><span class="o">::</span><span class="no">Unit</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="k">def</span> <span class="nf">setup</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Firefox</span><span class="o">::</span><span class="no">Profile</span><span class="p">.</span><span class="nf">new</span>
    <span class="n">profile</span><span class="p">[</span><span class="s1">'intl.accept_languages'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"it"</span>
    <span class="vi">@browser</span> <span class="o">=</span> <span class="no">Watir</span><span class="o">::</span><span class="no">Browser</span><span class="p">.</span><span class="nf">new</span> <span class="ss">:firefox</span><span class="p">,</span> <span class="ss">:profile</span> <span class="o">=&gt;</span> <span class="n">profile</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">teardown</span>
    <span class="vi">@browser</span><span class="p">.</span><span class="nf">close</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">test_redirection_it</span>
    <span class="vi">@browser</span><span class="p">.</span><span class="nf">goto</span><span class="p">(</span><span class="s2">"http://www.google.com"</span><span class="p">)</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="s2">"http://www.google.it"</span><span class="p">,</span> <span class="vi">@browser</span><span class="p">.</span><span class="nf">url</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">test_redirection_fr</span>
    <span class="vi">@browser</span><span class="p">.</span><span class="nf">goto</span><span class="p">(</span><span class="s2">"http://www.google.fr"</span><span class="p">)</span>
    <span class="n">assert_equal</span><span class="p">(</span><span class="s2">"http://www.google.it"</span><span class="p">,</span> <span class="vi">@browser</span><span class="p">.</span><span class="nf">url</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>L&#39;explication</h3>

<p>Pour ce test, je n&#39;ai pas utilisé cucumber, ou autre, mais juste la librairie unitest de ruby, et watir.</p>

<ul>
<li>Ligne 3 à 7 : le setup, joué avant chaque test. On crée un nouveau profil pour Firefox, contenant l&#39;attribut de langue voulu. Puis on charge Firefox.</li>
<li>Ligne 9 à 11 : le teardown, qui ferme le navigateur après chaque test.</li>
<li>Ligne 13 à 16 : premier test : on charge google.com, et on vérifie ensuite qu&#39;on a bien été redirigé vers google.it (puisque le navigateur signale une préférence pour cette langue)</li>
<li>Ligne 18 à 21 : second test, depuis google.fr</li>
</ul>

<h3>Pourquoi j&#39;ai perdu du temps</h3>

<p>J&#39;ai perdu du temps à faire fonctionner cela, pour la simple et bonne raison que cela ne marchait pas, et que mes tests testaient donc &quot;mal&quot;. La tête dans le guidon, je n&#39;ai pas testé que le fonctionnement du changement de langue soit juste. Je cherchais à corriger le problème là où il n&#39;était pas.</p>

<p>Quelques rappels :</p>

<ul>
<li>Changer la langue préférée pour l&#39;affichage des pages de Firefox ne change pas la langue du navigateur.undefinedundefined</li>
<li>Il est facile d&#39;afficher une page qui vous donne la langue préférée de votre navigateur. Voici un exemple de code en PHP :</li>
</ul>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
    <span class="nv">$lang</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_ACCEPT_LANGUAGE'</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="k">echo</span> <span class="nv">$lang</span><span class="p">;</span>
</code></pre></div></div>
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page6">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page4">Newer</a>
    
  
</div>

    </div>

  <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
  <script type="text/javascript" src="/public/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/public/js/script.js"></script>
  </body>
</html>
